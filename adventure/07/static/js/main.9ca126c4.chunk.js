(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{38:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"W",(function(){return w})),a.d(n,"H",(function(){return g})),a.d(n,"SIZE_X",(function(){return C})),a.d(n,"SIZE_Y",(function(){return I})),a.d(n,"SIZE_Z",(function(){return P})),a.d(n,"COLOR_00",(function(){return k})),a.d(n,"STRUCTURES",(function(){return M})),a.d(n,"studioConfig",(function(){return S})),a.d(n,"playerConfig",(function(){return x}));var o=a(9),r=a.n(o),s=a(12);function i(){return(i=Object(s.a)(r.a.mark((function e(t,a){var n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,n={CONSTANTS:a}),o=n.loaderAssets,s=p(t),e.next=6,o.loadAssets(s);case 6:n.assets=e.sent,c("beforeStartPlay",t,n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,a){for(var n=0;n<t.length;++n){var o=t[n],r=o.key,s=o.constr;o.initStateKey===e&&(a[r]=new s(a))}},p=function(e){for(var t=[],a=0;a<e.length;++a)if(e[a].assetsToLoad&&e[a].assetsToLoad.length)for(var n=0;n<e[a].assetsToLoad.length;++n)t.push(e[a].assetsToLoad[n]);return t},u=a(1),l=160,h=new u.k(10971157);console.log(h.r+", "+h.g+", "+h.b);var d=[{i:0,j:0,k:0,maybeTilesInds:[2],queue:{ind:22,calk:!0},resultTileIndex:2,tileData:{keyModel:"t_I",rotationY:Math.PI/2}},{i:0,j:0,k:1,maybeTilesInds:[2],queue:{ind:22,calk:!0},resultTileIndex:2,tileData:{keyModel:"t_I",rotationY:Math.PI/2}},{i:0,j:0,k:2,maybeTilesInds:[2],queue:{ind:22,calk:!0},resultTileIndex:2,tileData:{keyModel:"t_I",rotationY:Math.PI/2}},{i:0,j:0,k:3,maybeTilesInds:[2],queue:{ind:22,calk:!0},resultTileIndex:2,tileData:{keyModel:"t_I",rotationY:Math.PI/2}},{i:0,j:0,k:4,maybeTilesInds:[2],queue:{ind:22,calk:!0},resultTileIndex:2,tileData:{keyModel:"t_I",rotationY:Math.PI/2}}],b={iterateAll:function(e){for(var t=0;t<d.length;++t)e(d[t])}},m=new u.k(1,1,0),y={ENV_COLOR:m,FOG:{color:16776960,near:150,far:1e3,time:2e3},COLOR_00:[1,1,0],mat:"structureMaterial",X:-800,Y:-100,Z:160,mapFill:[{tile:"empty",place:[3,4,2]},{tile:"empty",place:[3,3,2]},{tile:"empty",place:[3,2,2]},{tile:"empty",place:[3,1,2]},{tile:"empty",place:[3,0,2]}]},f=function(){for(var e=[],t=3;t<6;++t)for(var a=0;a<5;++a)for(var n=2;n<7;++n)e.push({tile:"empty",place:[t,a,n]});return{ENV_COLOR:new u.k(.9,.9,0),FOG:{color:43690,near:150,far:700,time:2e3},COLOR_00:[.8,.1,.9],mat:"structureMaterial",SIZE_X:9,SIZE_Y:10,SIZE_Z:5,X:-800,Y:-270,Z:-170,mapFill:e}}(),O=function(){for(var e=[],t=3;t<15;++t)for(var a=0;a<5;++a)for(var n=0;n<3;++n)e.push({tile:"empty",place:[t,a,n]});return{ENV_COLOR:new u.k(.9,.9,.9),FOG:{color:43690,near:150,far:700,time:2e3},COLOR_00:[.1,.1,.9],mat:"structureMaterial",SIZE_X:7,SIZE_Y:15,SIZE_Z:5,X:-l,Y:-270,Z:-170,mapFill:e}}(),v=function(){for(var e=[],t=3;t<15;++t)for(var a=0;a<5;++a)for(var n=4;n<7;++n)e.push({tile:"empty",place:[t,a,n]});return{ENV_COLOR:new u.k(.3,0,.3),FOG:{color:5609813,near:150,far:700,time:2e3},COLOR_00:[.9,0,.7],mat:"structureMaterial",SIZE_X:7,SIZE_Y:15,SIZE_Z:5,X:-800,Y:-270,Z:-170,mapFill:e}}(),j={ENV_COLOR:new u.k(.403921568627451,.5019607843137255,.5176470588235295),FOG:{color:1253929,near:150,far:700,time:2e3},COLOR_00:[.5764705882352941,.8117647058823529,.8509803921568627],mat:"structureMaterial",SIZE_X:5,SIZE_Y:5,SIZE_Z:15,X:-800,Y:-270,Z:-170,mapFill:[]},_=function(){for(var e=[],t=0;t<7;++t)for(var a=0;a<5;++a)for(var n=4;n<5;++n)e.push({tile:"empty",place:[t,a,n]});return{ENV_COLOR:new u.k(.6,0,0),FOG:{color:5570560,near:150,far:700,time:2e3},COLOR_00:[.35,.35,.35],mat:"structureMaterial",SIZE_X:9,SIZE_Y:8,SIZE_Z:5,X:-640,Y:-270,Z:-170,mapFill:e}}(),w=160,g=80,C=7,I=15,P=7,k=[1,.3,1],M=[{ENV_COLOR:new u.k(.6,0,0),FOG:{color:4456448,near:150,far:1e3,time:2e3},COLOR_00:[1,.3,1],mat:"structureMaterial",SIZE_X:5,SIZE_Y:7,SIZE_Z:5,X:-320,Y:-270,Z:-170,mapFill:[{tile:"empty",place:[3,4,2]},{tile:"empty",place:[3,3,2]},{tile:"empty",place:[3,2,2]},{tile:"empty",place:[3,1,2]},{tile:"empty",place:[3,0,2]}]},{ENV_COLOR:new u.k(.7,.8,.7),FOG:{color:21845,near:150,far:700,time:2e3},COLOR_00:[.5725490196078431,.3803921568627451,.5725490196078431],SIZE_X:5,SIZE_Y:7,SIZE_Z:5,X:-320,Y:-270,Z:-170,mapFill:[{tile:"empty",place:[3,4,2]},{tile:"empty",place:[3,3,2]},{tile:"empty",place:[3,2,2]},{tile:"empty",place:[3,1,2]},{tile:"empty",place:[3,0,2]}]},v,j,O,{ENV_COLOR:new u.k(.5725490196078431,.5529411764705883,.396078431372549),FOG:{color:3090722,near:150,far:700,time:2e3},COLOR_00:[.9686274509803922,.9490196078431372,.8196078431372549],mat:"structureMaterial",SIZE_X:5,SIZE_Y:17,SIZE_Z:5,X:-480,Y:-430,Z:-170,mapFill:[{tile:"empty",place:[5,4,3]},{tile:"empty",place:[5,3,3]},{tile:"empty",place:[5,2,3]},{tile:"empty",place:[5,1,3]},{tile:"empty",place:[5,0,3]}]},_,{ENV_COLOR:new u.k(.05,.1,.2),FOG:{color:3421772,near:150,far:1e3,time:2e3},COLOR_00:[.1,1,.5],mat:"structureMaterialInv",SIZE_X:5,SIZE_Y:8,SIZE_Z:5,X:150,Y:-300,Z:-200,mapFill:[]},{ENV_COLOR:new u.k(.8,.8,.8),FOG:{color:8947848,near:150,far:400,time:2e3},COLOR_00:[1,1,1],mat:"structureMaterialInv",SIZE_X:6,SIZE_Y:10,SIZE_Z:6,X:-470,Y:-500,Z:-200,mapFill:[{tile:"empty",place:[6,5,3]},{tile:"empty",place:[6,4,3]},{tile:"empty",place:[6,3,3]},{tile:"empty",place:[6,2,3]},{tile:"empty",place:[6,1,3]},{tile:"empty",place:[6,0,3]}]},f,{ENV_COLOR:new u.k(0,0,0),FOG:{color:0,near:150,far:1e3,time:2e3},COLOR_00:[1,1,1],SIZE_X:5,SIZE_Y:8,SIZE_Z:5,X:-780,Y:-300,Z:-200,mapFill:[]},{ENV_COLOR:new u.k(0,0,0),FOG:{color:3090722,near:150,far:700,time:2e3},COLOR_00:[1,1,1],mat:"structureMaterialInv",SIZE_X:7,SIZE_Y:10,SIZE_Z:5,X:-480,Y:-250,Z:-170,mapFill:[{tile:"empty",place:[3,4,3]},{tile:"empty",place:[3,3,3]},{tile:"empty",place:[3,2,3]},{tile:"empty",place:[3,1,3]},{tile:"empty",place:[3,0,3]}]}],S={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:.1},composerAddPass:"Saturate"},x={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startPos:[0,-45,150],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:5592405,strength:1,dist:0,decay:.001,pos:[0,10,0]}},N=a(2),Z=a(3),T=a(19),X=a(20),L=function(){var e=null,t=null,a=null,n=null,o=null;return function(r,s){return new Promise((function(i){(function(r){return"obj"===r?e=e||new T.a:"glb"===r||"gltf"===r?a=a||new X.a:"img"===r?t=t||new u.tb:"cubeTextures"===r?n=n||new u.l:"soundMp3"===r?o=o||new u.d:void 0})(s).load(r,i)}))}},Y=function(){function e(){Object(N.a)(this,e),this.resources={},this._load=L()}return Object(Z.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(a){var n=t._load,o=t.resources;function i(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(r.a.mark((function t(s){var c,p,u,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[s]){t.next=5;break}return c=e[s],p=c.key,u=c.path,l=c.type,t.next=4,n(u,l);case 4:o[p]=t.sent;case 5:if(++s,e[s]){t.next=10;break}a(o),t.next=12;break;case 10:return t.next=12,i(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i(0)}))}}]),e}(),F=function(){function e(){Object(N.a)(this,e),this._storage={}}return Object(Z.a)(e,[{key:"emit",value:function(e){var t=this;return function(a){return E(t._storage)(e).forEach((function(e){return e(a)}))}}},{key:"subscribe",value:function(e){var t=this;return function(a){return E(t._storage)(e).push(a),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==a}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),E=function(e){return function(t){return e[t]=e[t]||[]}},D=a(5),A=a(44),R=function(){function e(){var t=this;Object(N.a)(this,e),this._subscribers=[];var a={time:0,delta:0,count:0,oldTime:0},n=A.a((function(){return a}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var a=0;a<t._subscribers.length;++a)t._subscribers[a](Object(D.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return a=e}));!function e(){requestAnimationFrame(e),n(a)}()}return Object(Z.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),G=a(10),B=a(21),z=function(){function e(t){var a=this;Object(N.a)(this,e),this._root=t;t.assets;var n=t.emitter,o=t.CONSTANTS.studioConfig,r=o.canId,s=o.rendererCon;s.canvas=document.getElementById(r),this._renderer=new u.zb(s),this._renderer.setClearColor(10027008),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new u.lb,this._scene.fog=new u.s(4456448,150,1e3),this._playerCamera=new u.ab(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new u.ab(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,500,100);var i=new B.a(this._controlsCamera,this._renderer.domElement);i.target.set(0,0,0),i.update();var c=new u.xb,p=!0;n.subscribe("keyEvent")((function(e){e.o&&(p?(p=!1,a._playerCamera.getWorldPosition(c),i.update()):p=!0)}));var l=function(){var e={width:window.innerWidth,height:window.innerHeight};a._renderer.setSize(e.width,e.height),a._controlsCamera&&(a._controlsCamera.aspect=e.width/e.height,a._controlsCamera.updateProjectionMatrix()),a._playerCamera&&(a._playerCamera.aspect=e.width/e.height,a._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",l),l(),this.addToScene=function(e){return a._scene.add(e)},this.removeFromScene=function(e){return a._scene.remove(e)};this.drawFrame=function(){.01,p?a._renderer.render(a._scene,a._playerCamera):a._renderer.render(a._scene,a._controlsCamera)}}return Object(Z.a)(e,[{key:"setCamera",value:function(e){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),this._playerCamera=e}},{key:"changeFog",value:function(e){var t=this,a=e.near,n=e.far,o=e.color,r=e.time,s={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},i={color:new u.k(o),near:a,far:n};new G.b(s).to(i,r).onUpdate((function(){t._scene.fog.color=s.color,t._scene.fog.near=s.near,t._scene.fog.far=s.far})).start()}},{key:"changeEnvColor",value:function(e){var t=this,a={color:this._scene.fog.color},n={color:e};new G.b(a).to(n,3e3).onUpdate((function(){t._scene.fog.color=a.color,t._renderer.setClearColor(a.color.getHex())})).start()}}]),e}(),q=function(){function e(t){Object(N.a)(this,e);var a=t.emitter,n={up:!1,down:!1,left:!1,right:!1,p:!1},o={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=o,this.keys=n;var r=function(e,t){switch(e){case 38:case 87:o.up&&(n.up=t);break;case 40:case 83:o.down&&(n.down=t);break;case 37:case 65:n.left=t;break;case 39:case 68:n.right=t;break;case 79:n.o=t;break;case 80:n.p=t}a.emit("keyEvent")(n)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),a.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),a.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(Z.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),W=a(22),U=function(){return navigator.maxTouchPoints||"ontouchstart"in document.documentElement},V=function(){return"undefined"!==typeof window.orientation},H=function(){var e=null,t=!1;window.navigator.userAgent.match(/iPhone/i)&&(t=!0),(window.navigator.userAgent.match(/Mobile/i)||window.navigator.userAgent.match(/iPhone/i)||window.navigator.userAgent.match(/iPod/i)||window.navigator.userAgent.match(/IEMobile/i)||window.navigator.userAgent.match(/Windows Phone/i)||window.navigator.userAgent.match(/Android/i)||window.navigator.userAgent.match(/BlackBerry/i)||window.navigator.userAgent.match(/webOS/i))&&(e="phone"),(window.navigator.userAgent.match(/Tablet/i)||window.navigator.userAgent.match(/iPad/i)||window.navigator.userAgent.match(/Nexus 7/i)||window.navigator.userAgent.match(/Nexus 10/i)||window.navigator.userAgent.match(/KFAPWI/i))&&(e="tablet"),window.navigator.userAgent.match(/Intel Mac/i)&&(e="desktop");var a=!1;navigator.userAgent.match("CriOS")&&(a=!0);var n=!1;navigator.userAgent.match("FxiOS")&&(n=!0);var o=!1;return navigator.userAgent.indexOf("Firefox")>0&&(o=!0),{mode:e,isIphone:t,isChrome:a,isFirefox:o,isFirefoxIOS:n,isWebViewIOS:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)}},K=function(){function e(t){var a=this;Object(N.a)(this,e);var n=t.studio,o=t.CONSTANTS.playerConfig,r=o.cameraData,s=o.lightDataOne;this._camera=null,this.isBlocked=!0,this.isFreeze=!0;var i=function(){var e=U(),t=V(),a="desktop";e&&t&&(a="phone");var n,o=H();return"desktop"===a?n="desktop":("tablet"===o.mode&&(n="tablet"),"phone"===o.mode&&(n=o.isIphone?"iOS_phone":"Android_phone")),{mode:a,isIphone:o.isIphone,isChrome:o.isChrome,isFirefox:o.isFirefox,isFirefoxIOS:o.isFirefoxIOS,isWebViewIOS:o.isWebViewIOS,deviceType:n}}();this.isNeedControls="desktop"===i.deviceType,console.log(i.deviceType),this.mesh=new u.Y;var c=r.fov,p=r.ratio,l=r.near,h=r.far;if(this._camera=new u.ab(c,p,l,h),this._camera.position.fromArray([0,0,-2]),this.isNeedControls?(this.controls=new W.a(this._camera,document.body),this.mesh=this._camera):this.mesh.add(this._camera),this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new u.Y,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new u.Y,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new u.Y,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj),s){var d=s.color,b=s.strenth,m=s.pos,y=new u.cb(d,b);y.position.fromArray(m),this.mesh.add(y)}n.setCamera(this._camera),n.addToScene(this.mesh),t.emitter.subscribe("clickButtonMouse")((function(){a.controlsLock()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===document.body||(a._camera.rotation.z=0,a._camera.rotation.x=0)}))}return Object(Z.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,a){this.mesh.position.set(e,t,a)}},{key:"controlsLock",value:function(){this.controls&&this.controls.lock()}},{key:"controlsUnlock",value:function(){this.controls&&(this.controls.unlock(),this._camera.rotation.z=0,this._camera.rotation.x=0)}}]),e}(),$=a(11),J=function(){function e(){Object(N.a)(this,e),this._arrMeshes=[],this._vecStart=new u.xb,this._vecDir=new u.xb,this._rayCaster=new u.jb(this._vecStart,this._vecDir)}return Object(Z.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,a){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var n=this._rayCaster.intersectObjects(this._arrMeshes);return n[0]&&n[0].distance<a?[!0,n[0]]:[!1,null]}}]),e}(),Q=function(){function e(t){var a=this;Object(N.a)(this,e);var n=t.emitter,o=t.CONSTANTS,r=t.player;t.assets,t.studio;r.mesh.position.fromArray([0,0,0]),this._collisionsBottom=new J,this._collisionsWalls=new J;var s=o.playerConfig,i=s.speed,c=s.speedDown,p=s.speedRot,l=!0;r.toggleBlocked=function(e){return l=e},this.isCanMove={forward:!0,back:!0},r.toggleCanMove=function(e,t){return a.isCanMove[e]=t},this._isTabCurrent=!0,document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState?this._isTabCurrent=!0:this._isTabCurrent=!1})),this.isFreeze=!1;var h={},d=!1,b=new u.xb;this.update=function(e){if(a._isTabCurrent&&!a.isFreeze&&(r.controls&&r.controls.isLocked?(h.left&&r.controls.moveRight(-p*e.count*40),h.right&&r.controls.moveRight(p*e.count*40)):(h.left&&r.mesh.rotateY(p*e.count),h.right&&r.mesh.rotateY(-p*e.count)),!l)){b.x=r.mesh.position.x,b.y=r.mesh.position.y,b.z=r.mesh.position.z,h.up&&a.isCanMove.forward&&function(e){var t=a._collisionsWalls.checkCollisions(r.mesh,r.frontObj,17),o=Object($.a)(t,2),s=o[0],c=o[1];s?c.object.userData.type&&"alert"===c.object.userData.type&&n.emit("collision")(c.object.userData.event):(r.controls&&r.controls.isLocked?r.controls.moveForward(i*e.count):r.mesh.translateZ(-i*e.count),n.emit("playerMove")("forward"))}(e),h.down&&a.isCanMove.back&&function(e){var t=a._collisionsWalls.checkCollisions(r.mesh,r.backObj,17);Object($.a)(t,1)[0]||(r.controls&&r.controls.isLocked?r.controls.moveForward(-i*e.count):r.mesh.translateZ(i*e.count),n.emit("playerMove")("back"))}(e),b.x===r.mesh.position.x&&b.z===r.mesh.position.z&&d&&(d=!1,t.system_Sound.stopWalk());var o=!1;b.x===r.mesh.position.x&&b.z===r.mesh.position.z||d||(o=!0),function(e){var t=a._collisionsBottom.checkCollisions(r.mesh,r.bottomObj,17.2),n=Object($.a)(t,2),o=n[0],s=n[1];o&&17>s.distance?r.mesh.translateY(17-s.distance):o||(r.mesh.position.y+=c*e.count)}(e),b.y>r.mesh.position.y&&(d=!1,t.system_Sound.stopWalk(),o=!1),o&&(d=!0,t.system_Sound.startWalk()),h.p&&console.log("player.mesh.position.fromArray([".concat(r.mesh.position.x,", ").concat(r.mesh.position.y,", ").concat(r.mesh.position.z,"])"))}},n.subscribe("keyEvent")((function(e){return h=e}))}return Object(Z.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsBottom.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsBottom.removeItemFromCollision(e)}},{key:"addItemToPlayerCollisionWalls",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemToPlayerCollisionWalls",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),ee=a(0),te=function(e,t){for(var a=t.SIZE_X,n=t.SIZE_Y,o=t.SIZE_Z,r=[],s=0;s<n;++s){for(var i=[],c=0;c<o;++c){for(var p=[],u=function(t){var a=[];e.map((function(e,t){a.push(t)})),p.push({resultTileIndex:null,maybeTilesInds:a,i:s,j:c,k:t})},l=0;l<a;++l)u(l);i.push(p)}r.push(i)}var h=function(e,t,a,n){for(var o={},r=0;r<e.length;++r)for(var s=0;s<e[r].length;++s)for(var i=0;i<e[r][s].length;++i)o[r+"_"+s+"_"+i]=e[r][s][i];var c=0,p=0,u=[];return function e(t,a,n){o["".concat(t,"_").concat(a,"_").concat(n)]&&(o["".concat(t,"_").concat(a,"_").concat(n)].queue?(++p,o["".concat(t,"_").concat(a,"_").concat(n)].queue.calk=!0):(u.push([t,a,n]),++p,++c,o["".concat(t,"_").concat(a,"_").concat(n)].queue={ind:c,calk:!0}),o["".concat(t,"_").concat(a,"_").concat(n+1)]&&!o["".concat(t,"_").concat(a,"_").concat(n+1)].queue&&(u.push([t,a,n+1]),++c,o["".concat(t,"_").concat(a,"_").concat(n+1)].queue={ind:c}),o["".concat(t,"_").concat(a,"_").concat(n-1)]&&!o["".concat(t,"_").concat(a,"_").concat(n-1)].queue&&(u.push([t,a,n-1]),++c,o["".concat(t,"_").concat(a,"_").concat(n-1)].queue={ind:c}),o["".concat(t,"_").concat(a+1,"_").concat(n)]&&!o["".concat(t,"_").concat(a+1,"_").concat(n)].queue&&(u.push([t,a+1,n]),++c,o["".concat(t,"_").concat(a+1,"_").concat(n)].queue={ind:c}),o["".concat(t,"_").concat(a-1,"_").concat(n)]&&!o["".concat(t,"_").concat(a-1,"_").concat(n)].queue&&(u.push([t,a-1,n]),++c,o["".concat(t,"_").concat(a-1,"_").concat(n)].queue={ind:c}),u[p+1]?e.apply(void 0,Object(ee.a)(u[p+1])):e(t+1,4,4))}(0,Math.floor(n/2),Math.floor(t/2)),u}(r,a,0,o),d=0;return{sizeZ:o,sizeY:n,sizeX:a,items:r,checkNextMapItemIndexes:function(e,t,a){if(h[d]){var n=h[d];return++d,{nextY:n[0],nextZ:n[1],nextX:n[2]}}return{nextY:null,nextZ:null,nextX:null}},iterateAll:function(e){for(var t=0;t<n;++t)for(var s=0;s<o;++s)for(var i=0;i<a;++i)e(r[t][s][i])}}},ae={choiceFinalTileFromExists:function(e,t){var a=Object($.a)(e.src,3),n=a[0],o=a[1],r=a[2],s=t[n][o][r];if(!Number.isInteger(s.resultTileIndex)){if(!s.maybeTilesInds.length)return s.resultTileIndex=-1,void(s.maybeTilesInds=[]);var i=s.maybeTilesInds[Math.floor(Math.random()*s.maybeTilesInds.length)];s.resultTileIndex=i,s.maybeTilesInds=[i]}},filterMaybeArrByCompare:function(e,t,a){var n=Object($.a)(e.src,3),o=n[0],r=n[1],s=n[2],i=Object($.a)(e.with,3),c=i[0],p=i[1],u=i[2],l=e.withProp;if(t[o]&&t[o][r]&&t[o][r][s]&&!Number.isInteger(t[o][r][s].resultTileIndex)&&t[c]&&t[c][p]&&t[c][p][u]){var h=t[c][p][u].maybeTilesInds,d=t[o][r][s].maybeTilesInds;if(h&&h.length&&d&&d.length){for(var b=[],m=0;m<h.length;++m)for(var y=a[h[m]][l],f=0;f<y.length;++f)for(var O=0;O<d.length;++O)y[f]===d[O]&&b.push(d[O]);for(var v=[],j=0;j<b.length;++j){for(var _=!1,w=0;w<v.length;++w)v[w]===b[j]&&(_=!0);_||v.push(b[j])}t[o][r][s].maybeTilesInds=v}}}},ne=function(e){var t;return{generateMap:function(a){var n=1e4;return new Promise((function(o){console.log("!!! tiles",e),t=te(e,a),console.log("!!! map",t);for(var r=a.mapFill,s=0;s<r.length;++s){var i=r[s].place;t.items[i[0]][i[1]][i[2]].resultTileIndex=0,t.items[i[0]][i[1]][i[2]].maybeTilesInds=[0]}var c=function(a,o,r){return new Promise((function(s,i){if(--n<0)return console.log("max stack:",n),i();(function(t,a,n,o){return new Promise((function(r){var s=function(e,t,a,n){return[{action:"choiceFinalTileFromExists",src:[e,t,a]},{action:"filterMaybeArrByCompare",src:[e,t-1,a],with:[e,t,a],withProp:"canConnectNZ"},{action:"filterMaybeArrByCompare",src:[e,t+1,a],with:[e,t,a],withProp:"canConnectPZ"},{action:"filterMaybeArrByCompare",src:[e,t,a-1],with:[e,t,a],withProp:"canConnectNX"},{action:"filterMaybeArrByCompare",src:[e,t,a+1],with:[e,t,a],withProp:"canConnectPX"},{action:"filterMaybeArrByCompare",src:[e,t-1,a-1],with:[e,t-1,a],withProp:"canConnectNX"},{action:"filterMaybeArrByCompare",src:[e,t-1,a-1],with:[e,t,a-1],withProp:"canConnectNZ"},{action:"filterMaybeArrByCompare",src:[e,t-1,a+1],with:[e,t-1,a],withProp:"canConnectPX"},{action:"filterMaybeArrByCompare",src:[e,t-1,a+1],with:[e,t,a+1],withProp:"canConnectNZ"},{action:"filterMaybeArrByCompare",src:[e,t+1,a+1],with:[e,t,a+1],withProp:"canConnectPZ"},{action:"filterMaybeArrByCompare",src:[e,t+1,a+1],with:[e,t+1,a],withProp:"canConnectPX"},{action:"filterMaybeArrByCompare",src:[e,t+1,a-1],with:[e,t+1,a],withProp:"canConnectNX"},{action:"filterMaybeArrByCompare",src:[e,t+1,a-1],with:[e,t,a-1],withProp:"canConnectPZ"},{action:"filterMaybeArrByCompare",src:[e+1,t,a],with:[e,t,a],withProp:"canConnectPY"},{action:"filterMaybeArrByCompare",src:[e+1,t-1,a],with:[e,t-1,a],withProp:"canConnectPY"},{action:"filterMaybeArrByCompare",src:[e+1,t+1,a],with:[e,t+1,a],withProp:"canConnectPY"},{action:"filterMaybeArrByCompare",src:[e+1,t,a-1],with:[e,t,a-1],withProp:"canConnectPY"},{action:"filterMaybeArrByCompare",src:[e+1,t,a-1],with:[e,t,a-1],withProp:"canConnectPY"}]}(t,a,n);!function t(a){if(!s[a])return r();var n=s[a];ae[n.action](n,o.items,e),t(a+1)}(0)}))})(a,o,r,t).then((function(){t.items[a][o][r].hasOwnProperty("resultTileIndex")&&Number.isInteger(t.items[a][o][r].resultTileIndex)&&(t.items[a][o][r].tileData=e[t.items[a][o][r].resultTileIndex]),s()}))}))};!function e(){var a=t.checkNextMapItemIndexes(),n=a.nextY,r=a.nextZ,s=a.nextX;Number.isInteger(n)&&Number.isInteger(r)&&Number.isInteger(s)?c(n,r,s).then(e):(console.log("$$$$--"),o(t))}()}))},destroyMap:function(){for(var e=0;e<t.items.length;++e){for(var a=0;a<t.items[e].length;++a){for(var n=0;n<t.items[e][a].length;++n){for(var o in t.items[e][a][n])delete t.items[e][a][n][o];delete t.items[e][a][n]}delete t.items[e][a]}delete t.items[e]}t=null}}},oe=Float32Array;function re(e,t,a){return(a=a||new oe(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a}function se(e,t){t=t||new oe(3);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return a>1e-5&&(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a),t}function ie(e,t,a){return(a=a||new oe(3))[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a}function ce(e,t){var a=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return a*a+n*n+o*o}function pe(e,t){t=t||new oe(16);var a=e[0],n=e[1],o=e[2],r=e[3],s=e[4],i=e[5],c=e[6],p=e[7],u=e[8],l=e[9],h=e[10],d=e[11],b=e[12],m=e[13],y=e[14],f=e[15],O=h*f,v=y*d,j=c*f,_=y*p,w=c*d,g=h*p,C=o*f,I=y*r,P=o*d,k=h*r,M=o*p,S=c*r,x=u*m,N=b*l,Z=s*m,T=b*i,X=s*l,L=u*i,Y=a*m,F=b*n,E=a*l,D=u*n,A=a*i,R=s*n,G=O*i+_*l+w*m-(v*i+j*l+g*m),B=v*n+C*l+k*m-(O*n+I*l+P*m),z=j*n+I*i+M*m-(_*n+C*i+S*m),q=g*n+P*i+S*l-(w*n+k*i+M*l),W=1/(a*G+s*B+u*z+b*q);return t[0]=W*G,t[1]=W*B,t[2]=W*z,t[3]=W*q,t[4]=W*(v*s+j*u+g*b-(O*s+_*u+w*b)),t[5]=W*(O*a+I*u+P*b-(v*a+C*u+k*b)),t[6]=W*(_*a+C*s+S*b-(j*a+I*s+M*b)),t[7]=W*(w*a+k*s+M*u-(g*a+P*s+S*u)),t[8]=W*(x*p+T*d+X*f-(N*p+Z*d+L*f)),t[9]=W*(N*r+Y*d+D*f-(x*r+F*d+E*f)),t[10]=W*(Z*r+F*p+A*f-(T*r+Y*p+R*f)),t[11]=W*(L*r+E*p+R*d-(X*r+D*p+A*d)),t[12]=W*(Z*h+L*y+N*c-(X*y+x*c+T*h)),t[13]=W*(E*y+x*o+F*h-(Y*h+D*y+N*o)),t[14]=W*(Y*c+R*y+T*o-(A*y+Z*o+F*c)),t[15]=W*(A*h+X*o+D*c-(E*c+R*h+L*o)),t}var ue={copy:function(e,t){return(t=t||new oe(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,a,n){n=n||new oe(16);var o=se(re(e,t)),r=se(ie(a,o)),s=se(ie(o,r));return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=s[0],n[5]=s[1],n[6]=s[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},addVectors:function(e,t,a){return(a=a||new oe(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},subtractVectors:re,scaleVector:function(e,t,a){return(a=a||new oe(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},distance:function(e,t){return Math.sqrt(ce(e,t))},distanceSq:ce,normalize:se,compose:function(e,t,a,n){n=n||new oe(16);var o=t[0],r=t[1],s=t[2],i=t[3],c=o+o,p=r+r,u=s+s,l=o*c,h=o*p,d=o*u,b=r*p,m=r*u,y=s*u,f=i*c,O=i*p,v=i*u,j=a[0],_=a[1],w=a[2];return n[0]=(1-(b+y))*j,n[1]=(h+v)*j,n[2]=(d-O)*j,n[3]=0,n[4]=(h-v)*_,n[5]=(1-(l+y))*_,n[6]=(m+f)*_,n[7]=0,n[8]=(d+O)*w,n[9]=(m-f)*w,n[10]=(1-(l+b))*w,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},cross:ie,decompose:function(e,t,a,n){var o=ue.length(e.slice(0,3)),r=ue.length(e.slice(4,7)),s=ue.length(e.slice(8,11));(function(e){var t=e[0],a=e[1],n=e[2],o=e[3],r=e[4],s=e[5],i=e[6],c=e[7],p=e[8],u=e[9],l=e[10],h=e[11],d=e[12],b=e[13],m=e[14],y=e[15],f=l*y,O=m*h,v=i*y,j=m*c,_=i*h,w=l*c,g=n*y,C=m*o,I=n*h,P=l*o,k=n*c,M=i*o;return 1/(t*(f*s+j*u+_*b-(O*s+v*u+w*b))+r*(O*a+g*u+P*b-(f*a+C*u+I*b))+p*(v*a+C*s+k*b-(j*a+g*s+M*b))+d*(w*a+I*s+M*u-(_*a+P*s+k*u)))})(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];var i=ue.copy(e),c=1/o,p=1/r,u=1/s;i[0]*=c,i[1]*=c,i[2]*=c,i[4]*=p,i[5]*=p,i[6]*=p,i[8]*=u,i[9]*=u,i[10]*=u,function(e,t){var a=e[0],n=e[4],o=e[8],r=e[1],s=e[5],i=e[9],c=e[2],p=e[6],u=e[10],l=a+s+u;if(l>0){var h=.5/Math.sqrt(l+1);t[3]=.25/h,t[0]=(p-i)*h,t[1]=(o-c)*h,t[2]=(r-n)*h}else if(a>s&&a>u){var d=2*Math.sqrt(1+a-s-u);t[3]=(p-i)/d,t[0]=.25*d,t[1]=(n+r)/d,t[2]=(o+c)/d}else if(s>u){var b=2*Math.sqrt(1+s-a-u);t[3]=(o-c)/b,t[0]=(n+r)/b,t[1]=.25*b,t[2]=(i+p)/b}else{var m=2*Math.sqrt(1+u-a-s);t[3]=(r-n)/m,t[0]=(o+c)/m,t[1]=(i+p)/m,t[2]=.25*m}}(i,a),n[0]=o,n[1]=r,n[2]=s},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new oe(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new oe(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,a,n,o,r,s){return(s=s||new oe(16))[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(n-a),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2/(o-r),s[11]=0,s[12]=(e+t)/(e-t),s[13]=(a+n)/(a-n),s[14]=(o+r)/(o-r),s[15]=1,s},frustum:function(e,t,a,n,o,r,s){var i=t-e,c=n-a,p=r-o;return(s=s||new oe(16))[0]=2*o/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*o/c,s[6]=0,s[7]=0,s[8]=(e+t)/i,s[9]=(n+a)/c,s[10]=-(r+o)/p,s[11]=-1,s[12]=0,s[13]=0,s[14]=-2*o*r/p,s[15]=0,s},perspective:function(e,t,a,n,o){o=o||new oe(16);var r=Math.tan(.5*Math.PI-.5*e),s=1/(a-n);return o[0]=r/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(a+n)*s,o[11]=-1,o[12]=0,o[13]=0,o[14]=a*n*s*2,o[15]=0,o},translation:function(e,t,a,n){return(n=n||new oe(16))[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=t,n[14]=a,n[15]=1,n},translate:function(e,t,a,n,o){o=o||new oe(16);var r=e[0],s=e[1],i=e[2],c=e[3],p=e[4],u=e[5],l=e[6],h=e[7],d=e[8],b=e[9],m=e[10],y=e[11],f=e[12],O=e[13],v=e[14],j=e[15];return e!==o&&(o[0]=r,o[1]=s,o[2]=i,o[3]=c,o[4]=p,o[5]=u,o[6]=l,o[7]=h,o[8]=d,o[9]=b,o[10]=m,o[11]=y),o[12]=r*t+p*a+d*n+f,o[13]=s*t+u*a+b*n+O,o[14]=i*t+l*a+m*n+v,o[15]=c*t+h*a+y*n+j,o},xRotation:function(e,t){t=t||new oe(16);var a=Math.cos(e),n=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new oe(16);var a=Math.cos(e),n=Math.sin(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new oe(16);var a=Math.cos(e),n=Math.sin(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,a){a=a||new oe(16);var n=e[4],o=e[5],r=e[6],s=e[7],i=e[8],c=e[9],p=e[10],u=e[11],l=Math.cos(t),h=Math.sin(t);return a[4]=l*n+h*i,a[5]=l*o+h*c,a[6]=l*r+h*p,a[7]=l*s+h*u,a[8]=l*i-h*n,a[9]=l*c-h*o,a[10]=l*p-h*r,a[11]=l*u-h*s,e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},yRotate:function(e,t,a){a=a||new oe(16);var n=e[0],o=e[1],r=e[2],s=e[3],i=e[8],c=e[9],p=e[10],u=e[11],l=Math.cos(t),h=Math.sin(t);return a[0]=l*n-h*i,a[1]=l*o-h*c,a[2]=l*r-h*p,a[3]=l*s-h*u,a[8]=l*i+h*n,a[9]=l*c+h*o,a[10]=l*p+h*r,a[11]=l*u+h*s,e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},zRotate:function(e,t,a){a=a||new oe(16);var n=e[0],o=e[1],r=e[2],s=e[3],i=e[4],c=e[5],p=e[6],u=e[7],l=Math.cos(t),h=Math.sin(t);return a[0]=l*n+h*i,a[1]=l*o+h*c,a[2]=l*r+h*p,a[3]=l*s+h*u,a[4]=l*i-h*n,a[5]=l*c-h*o,a[6]=l*p-h*r,a[7]=l*u-h*s,e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},axisRotation:function(e,t,a){a=a||new oe(16);var n=e[0],o=e[1],r=e[2],s=Math.sqrt(n*n+o*o+r*r),i=(n/=s)*n,c=(o/=s)*o,p=(r/=s)*r,u=Math.cos(t),l=Math.sin(t),h=1-u;return a[0]=i+(1-i)*u,a[1]=n*o*h+r*l,a[2]=n*r*h-o*l,a[3]=0,a[4]=n*o*h-r*l,a[5]=c+(1-c)*u,a[6]=o*r*h+n*l,a[7]=0,a[8]=n*r*h+o*l,a[9]=o*r*h-n*l,a[10]=p+(1-p)*u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},axisRotate:function(e,t,a,n){n=n||new oe(16);var o=t[0],r=t[1],s=t[2],i=Math.sqrt(o*o+r*r+s*s),c=(o/=i)*o,p=(r/=i)*r,u=(s/=i)*s,l=Math.cos(a),h=Math.sin(a),d=1-l,b=c+(1-c)*l,m=o*r*d+s*h,y=o*s*d-r*h,f=o*r*d-s*h,O=p+(1-p)*l,v=r*s*d+o*h,j=o*s*d+r*h,_=r*s*d-o*h,w=u+(1-u)*l,g=e[0],C=e[1],I=e[2],P=e[3],k=e[4],M=e[5],S=e[6],x=e[7],N=e[8],Z=e[9],T=e[10],X=e[11];return n[0]=b*g+m*k+y*N,n[1]=b*C+m*M+y*Z,n[2]=b*I+m*S+y*T,n[3]=b*P+m*x+y*X,n[4]=f*g+O*k+v*N,n[5]=f*C+O*M+v*Z,n[6]=f*I+O*S+v*T,n[7]=f*P+O*x+v*X,n[8]=j*g+_*k+w*N,n[9]=j*C+_*M+w*Z,n[10]=j*I+_*S+w*T,n[11]=j*P+_*x+w*X,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},scaling:function(e,t,a,n){return(n=n||new oe(16))[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},scale:function(e,t,a,n,o){return(o=o||new oe(16))[0]=t*e[0],o[1]=t*e[1],o[2]=t*e[2],o[3]=t*e[3],o[4]=a*e[4],o[5]=a*e[5],o[6]=a*e[6],o[7]=a*e[7],o[8]=n*e[8],o[9]=n*e[9],o[10]=n*e[10],o[11]=n*e[11],e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},multiply:function(e,t,a){a=a||new oe(16);var n=t[0],o=t[1],r=t[2],s=t[3],i=t[4],c=t[5],p=t[6],u=t[7],l=t[8],h=t[9],d=t[10],b=t[11],m=t[12],y=t[13],f=t[14],O=t[15],v=e[0],j=e[1],_=e[2],w=e[3],g=e[4],C=e[5],I=e[6],P=e[7],k=e[8],M=e[9],S=e[10],x=e[11],N=e[12],Z=e[13],T=e[14],X=e[15];return a[0]=n*v+o*g+r*k+s*N,a[1]=n*j+o*C+r*M+s*Z,a[2]=n*_+o*I+r*S+s*T,a[3]=n*w+o*P+r*x+s*X,a[4]=i*v+c*g+p*k+u*N,a[5]=i*j+c*C+p*M+u*Z,a[6]=i*_+c*I+p*S+u*T,a[7]=i*w+c*P+p*x+u*X,a[8]=l*v+h*g+d*k+b*N,a[9]=l*j+h*C+d*M+b*Z,a[10]=l*_+h*I+d*S+b*T,a[11]=l*w+h*P+d*x+b*X,a[12]=m*v+y*g+f*k+O*N,a[13]=m*j+y*C+f*M+O*Z,a[14]=m*_+y*I+f*S+O*T,a[15]=m*w+y*P+f*x+O*X,a},inverse:pe,transformVector:function(e,t,a){a=a||new oe(4);for(var n=0;n<4;++n){a[n]=0;for(var o=0;o<4;++o)a[n]+=t[o]*e[4*o+n]}return a},transformPoint:function(e,t,a){a=a||new oe(3);var n=t[0],o=t[1],r=t[2],s=n*e[3]+o*e[7]+r*e[11]+e[15];return a[0]=(n*e[0]+o*e[4]+r*e[8]+e[12])/s,a[1]=(n*e[1]+o*e[5]+r*e[9]+e[13])/s,a[2]=(n*e[2]+o*e[6]+r*e[10]+e[14])/s,a},transformDirection:function(e,t,a){a=a||new oe(3);var n=t[0],o=t[1],r=t[2];return a[0]=n*e[0]+o*e[4]+r*e[8],a[1]=n*e[1]+o*e[5]+r*e[9],a[2]=n*e[2]+o*e[6]+r*e[10],a},transformNormal:function(e,t,a){a=a||new oe(3);var n=pe(e),o=t[0],r=t[1],s=t[2];return a[0]=o*n[0]+r*n[1]+s*n[2],a[1]=o*n[4]+r*n[5]+s*n[6],a[2]=o*n[8]+r*n[9]+s*n[10],a},setDefaultType:function(e){var t=oe;return oe=e,t}},le=(Math.random,function(e,t,a,n){return[].concat(Object(ee.a)(e),Object(ee.a)(t),Object(ee.a)(a),Object(ee.a)(e),Object(ee.a)(a),Object(ee.a)(n))}),he=function(e,t,a,n){return[].concat(Object(ee.a)(e),Object(ee.a)(t),Object(ee.a)(a),Object(ee.a)(e),Object(ee.a)(a),Object(ee.a)(n))},de=function(e){return[].concat(Object(ee.a)(e),Object(ee.a)(e),Object(ee.a)(e),Object(ee.a)(e),Object(ee.a)(e),Object(ee.a)(e))},be=function(e,t){for(var a=ue.yRotation(t),n=0;n<e.length;n+=3){var o=ue.transformPoint(a,[e[n+0],e[n+1],e[n+2],1]);e[n+0]=o[0],e[n+1]=o[1],e[n+2]=o[2]}},me=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=ue.translation(t,a,n),r=0;r<e.length;r+=3){var s=ue.transformPoint(o,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=s[0],e[r+1]=s[1],e[r+2]=s[2]}},ye=1/3,fe=2*ye,Oe={line_p0:he([0,.75],[.25,.75],[.25,1],[0,1]),line_p1:he([0,.5],[.25,.5],[.25,.75],[0,.75]),columnSide_0:he([0,0],[.0625,0],[.0625,.25],[0,.25]),columnSide_1:he([.0625,0],[.125,0],[.125,.25],[.0625,.25]),columnSide_2:he([.125,0],[.1875,0],[.1875,.25],[.125,.25]),columnSide_3:he([.1875,0],[.25,0],[.25,.25],[.1875,.25]),three:[.125,.5,0,.25,.25,.25],lines:he([.5,0],[.75,0],[.75,.25],[.5,.25]),points:he([.25,0],[.5,0],[.5,.25],[.25,.25]),empty:he([.25,.25],[.5,.25],[.5,.5],[.25,.5]),briks:he([.75,0],[1,0],[1,.25],[.75,.25]),gor_pattern_00:he([.25,.96875],[.5,.96875],[.5,1],[.25,1]),gor_pattern_01:he([.25,.9375],[.5,.9375],[.5,.96875],[.25,.96875]),face_00:he([.5,.75],[.75,.75],[.75,1],[.5,1]),white:he([.75,.5],[1,.5],[1,.75],[.75,.75]),"0_0":he([0,0],[ye,0],[ye,ye],[0,ye]),"1_0":he([ye,0],[fe,0],[fe,ye],[ye,ye]),"2_0":he([fe,0],[1,0],[1,ye],[fe,ye]),"0_1":he([0,ye],[ye,ye],[ye,fe],[0,fe]),"1_1":he([ye,ye],[fe,ye],[fe,fe],[ye,fe]),"2_1":he([fe,ye],[1,ye],[1,fe],[fe,fe]),"0_2":he([0,fe],[ye,fe],[ye,1],[0,1]),"1_2":he([ye,fe],[fe,fe],[fe,1],[ye,1]),"2_2":he([fe,fe],[1,fe],[1,1],[fe,1])},ve=["columnSide_1","columnSide_2","columnSide_3"],je=function(){var e=ve[Math.floor(Math.random()*ve.length)];return Oe[e]},_e=Math.sin,we=Math.cos,ge=function(e){for(var t=e.h,a=void 0===t?g:t,n=e.w,o=void 0===n?3:n,r=e.bottomW,s=void 0===r?5:r,i=e.bottomH,c=void 0===i?5:i,p=e.topH,u=void 0===p?15:p,l=[],h=[],d=[],b=c+2,m=a-u-2,y=a-u,f=o,O=s,v=de(k),j=0;j<8;++j){var _=(j-1)/8*Math.PI*2;0===j&&(_=7/8*Math.PI*2);var w=j/8*Math.PI*2;l.push.apply(l,[0,-8,0,_e(w)*O,0,we(w)*O,_e(_)*O,0,we(_)*O].concat(Object(ee.a)(le([_e(_)*O,0,we(_)*O],[_e(w)*O,0,we(w)*O],[_e(w)*O,c,we(w)*O],[_e(_)*O,c,we(_)*O])),Object(ee.a)(le([_e(_)*O,c,we(_)*O],[_e(w)*O,c,we(w)*O],[_e(w)*f,b,we(w)*f],[_e(_)*f,b,we(_)*f])))),d.push.apply(d,Object(ee.a)(Oe.three).concat(Object(ee.a)(Oe.empty),Object(ee.a)(Oe.line_p1))),h.push.apply(h,Object(ee.a)(k).concat(Object(ee.a)(k),Object(ee.a)(k),Object(ee.a)(v),Object(ee.a)(v)))}for(var C=b;C<m;){var I=30*Math.random()+2;C+I>m&&(I=m-C);for(var P=0;P<8;++P){var M=(P-1)/8*Math.PI*2;0===P&&(M=7/8*Math.PI*2);var S=P/8*Math.PI*2;l.push.apply(l,Object(ee.a)(le([_e(M)*f,C,we(M)*f],[_e(S)*f,C,we(S)*f],[_e(S)*f,C+I,we(S)*f],[_e(M)*f,C+I,we(M)*f]))),d.push.apply(d,Object(ee.a)(je())),h.push.apply(h,Object(ee.a)(v))}C+=I}for(var x=0;x<8;++x){var N=(x-1)/8*Math.PI*2;0===x&&(N=7/8*Math.PI*2);var Z=x/8*Math.PI*2;l.push.apply(l,Object(ee.a)(le([_e(N)*f,m,we(N)*f],[_e(Z)*f,m,we(Z)*f],[_e(Z)*O,y,we(Z)*O],[_e(N)*O,y,we(N)*O])).concat(Object(ee.a)(le([_e(N)*O,y,we(N)*O],[_e(Z)*O,y,we(Z)*O],[_e(Z)*O,a,we(Z)*O],[_e(N)*O,a,we(N)*O])),[0,a+12,0,_e(N)*O,a,we(N)*O,_e(Z)*O,a,we(Z)*O])),d.push.apply(d,Object(ee.a)(Oe.empty).concat(Object(ee.a)(Oe.line_p1),Object(ee.a)(Oe.three))),h.push.apply(h,Object(ee.a)(v).concat(Object(ee.a)(v),Object(ee.a)(k),Object(ee.a)(k),Object(ee.a)(k)))}return{v:l,col:[],u:d,c:h}},Ce=w/6,Ie=function(e){var t=e.nX_pZ,a=void 0===t?[-Ce,0,Ce]:t,n=e.pX_pZ,o=void 0===n?[Ce,0,Ce]:n,r=e.pX_nZ,s=void 0===r?[Ce,0,-Ce]:r,i=e.nX_nZ,c=void 0===i?[-Ce,0,-Ce]:i,p=e.minusH,u=void 0===p?-5:p,l=(e.w,e.d,e.color),h=[],d=[],b=[],m=[],y=de(void 0===l?k:l),f=Object(ee.a)(y);return h.push.apply(h,Object(ee.a)(le(Object(ee.a)(a),Object(ee.a)(o),Object(ee.a)(s),Object(ee.a)(c)))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.empty)),m.push.apply(m,Object(ee.a)(le(Object(ee.a)(a),Object(ee.a)(o),Object(ee.a)(s),Object(ee.a)(c)))),h.push.apply(h,Object(ee.a)(le([c[0],c[1]+u,c[2]],[s[0],s[1]+u,s[2]],[o[0],o[1]+u,o[2]],[a[0],a[1]+u,a[2]]))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.points)),h.push.apply(h,Object(ee.a)(le([a[0],a[1]+u,a[2]],[o[0],o[1]+u,o[2]],[o[0],o[1],o[2]],[a[0],a[1],a[2]]))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.gor_pattern_00)),h.push.apply(h,Object(ee.a)(le([c[0],c[1]+u,c[2]],[a[0],a[1]+u,a[2]],[a[0],a[1],a[2]],[c[0],c[1],c[2]]))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.gor_pattern_00)),h.push.apply(h,Object(ee.a)(le([o[0],o[1]+u,o[2]],[s[0],s[1]+u,s[2]],[s[0],s[1],s[2]],[o[0],o[1],o[2]]))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.gor_pattern_00)),h.push.apply(h,Object(ee.a)(le([s[0],s[1]+u,s[2]],[c[0],c[1]+u,c[2]],[c[0],c[1],c[2]],[s[0],s[1],s[2]]))),d.push.apply(d,Object(ee.a)(f)),b.push.apply(b,Object(ee.a)(Oe.gor_pattern_00)),{v:h,col:m,u:b,c:d}},Pe=w/6,ke=function(e){var t=e.w,a=void 0===t?Pe:t,n=e.d,o=void 0===n?3:n,r=e.h,s=void 0===r?12:r,i=e.color,c=[],p=[],u=[],l=[],h=de(void 0===i?k:i),d=Object(ee.a)(h);return c.push.apply(c,Object(ee.a)(le([-a,s,o],[a,s,o],[a,s,-o],[-a,s,-o]))),p.push.apply(p,Object(ee.a)(d)),u.push.apply(u,Object(ee.a)(Oe.gor_pattern_01)),c.push.apply(c,Object(ee.a)(le([-a,s-3,o],[a,s-3,o],[a,s,o],[-a,s,o]))),p.push.apply(p,Object(ee.a)(d)),u.push.apply(u,Object(ee.a)(Oe.gor_pattern_01)),c.push.apply(c,Object(ee.a)(le([a,s-3,-o],[-a,s-3,-o],[-a,s,-o],[a,s,-o]))),p.push.apply(p,Object(ee.a)(d)),u.push.apply(u,Object(ee.a)(Oe.gor_pattern_01)),l.push.apply(l,Object(ee.a)(le([-a,s,o],[a,s,o],[a,s,-o],[-a,s,-o]))),{v:c,col:l,u:u,c:p}},Me=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g/2,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g/2,0),n.push.apply(n,Object(ee.a)(s.col));var i=ke({});me(i.v,0,g/2,-w/6),e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),me(i.col,0,g/2,-w/6),n.push.apply(n,Object(ee.a)(i.col));var c=ke({});be(c.v,-Math.PI/2),me(c.v,-w/6,g/2,0),e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),be(c.col,-Math.PI/2),me(c.col,-w/6,g/2,0),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({});me(p.v,0,g/2,w/3),e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),me(p.col,0,g/2,w/3),n.push.apply(n,Object(ee.a)(p.col));var u=Ie({});return me(u.v,w/3,g/2,0),e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),me(u.col,w/3,g/2,0),n.push.apply(n,Object(ee.a)(u.col)),{v:e,c:t,u:a,col:n}},Se=Math.sin,xe=Math.cos,Ne=function(e){for(var t=e.w,a=void 0===t?w/3:t,n=e.h,o=void 0===n?g-5:n,r=e.d,s=void 0===r?w/3/2:r,i=(e.segmentsNum,[]),c=[],p=[],u=de(k),l=-Math.PI/2,h=Math.PI/8,d=a/2-5,b=a/2,m=o-b-8,y=3.7,f=m+d,O=1;O<9;++O){var v=l+h*(O-1),j=l+h*O;i.push.apply(i,Object(ee.a)(le([Se(v)*d,m+xe(v)*d,s],[Se(j)*d,m+xe(j)*d,s],[Se(j)*b,m+xe(j)*b,s],[Se(v)*b,m+xe(v)*b,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.empty)),i.push.apply(i,Object(ee.a)(le([Se(v)*b,m+xe(v)*b,s],[Se(j)*b,m+xe(j)*b,s],[Se(j)*b,o,s],[Se(v)*b,o,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.empty)),i.push.apply(i,Object(ee.a)(le([Se(v)*d,m+xe(v)*d,-s],[Se(j)*d,m+xe(j)*d,-s],[Se(j)*d,m+xe(j)*d,s],[Se(v)*d,m+xe(v)*d,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.columnSide_0)),i.push.apply(i,Object(ee.a)(le([Se(j)*d,m+xe(j)*d,-s],[Se(v)*d,m+xe(v)*d,-s],[Se(v)*b,m+xe(v)*b,-s],[Se(j)*b,m+xe(j)*b,-s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.empty)),i.push.apply(i,Object(ee.a)(le([Se(j)*b,m+xe(j)*b,-s],[Se(v)*b,m+xe(v)*b,-s],[Se(v)*b,o,-s],[Se(j)*b,o,-s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.empty))}return i.push.apply(i,Object(ee.a)(le([-3.7,f,s+1],[y,f,s+1],[5,o,s+1],[-5,o,s+1]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.face_00)),i.push.apply(i,Object(ee.a)(le([y,f,-s-1],[-3.7,f,-s-1],[-5,o,-s-1],[5,o,-s-1]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.face_00)),i.push.apply(i,Object(ee.a)(le([-a/2+1,m,-s],[-a/2+1,m,s],[-a/2+1,o,s],[-a/2+1,o,-s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.briks)),i.push.apply(i,Object(ee.a)(le([a/2-1,m,s],[a/2-1,m,-s],[a/2-1,o,-s],[a/2-1,o,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.briks)),i.push.apply(i,Object(ee.a)(le([-a/2,m,-s],[-d,m,-s],[-d,m,s],[-a/2,m,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.lines)),i.push.apply(i,Object(ee.a)(le([d,m,-s],[a/2,m,-s],[a/2,m,s],[d,m,s]))),c.push.apply(c,Object(ee.a)(u)),p.push.apply(p,Object(ee.a)(Oe.lines)),{v:i,col:[],u:p,c:c}},Ze=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g/2,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g/2,0),n.push.apply(n,Object(ee.a)(s.col));var i=ke({});be(i.v,-Math.PI/2),me(i.v,-w/6,g/2,0),e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),be(i.col,-Math.PI/2),me(i.col,-w/6,g/2,0),n.push.apply(n,Object(ee.a)(i.col));var c=ke({});be(c.v,-Math.PI/2),me(c.v,w/6,g/2,0),e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),be(c.col,-Math.PI/2),me(c.col,w/6,g/2,0),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({});me(p.v,0,g/2,w/3),e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),me(p.col,0,g/2,w/3),n.push.apply(n,Object(ee.a)(p.col));var u=Ie({});me(u.v,0,g/2,-w/3),e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),me(u.col,0,g/2,-w/3),n.push.apply(n,Object(ee.a)(u.col));var l=Ne({});return me(l.v,0,-g/2,0),e.push.apply(e,Object(ee.a)(l.v)),t.push.apply(t,Object(ee.a)(l.c)),a.push.apply(a,Object(ee.a)(l.u)),{v:e,c:t,u:a,col:n}},Te=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g/2,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g/2,0),n.push.apply(n,Object(ee.a)(s.col));var i=Ie({});me(i.v,0,g/2,w/3),e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),me(i.col,0,g/2,w/3),n.push.apply(n,Object(ee.a)(i.col));var c=Ie({});me(c.v,w/3,g/2,0),e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),me(c.col,w/3,g/2,0),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({});me(p.v,-w/3,g/2,0),e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),me(p.col,-w/3,g/2,0),n.push.apply(n,Object(ee.a)(p.col));var u=Ie({});me(u.v,0,g/2,-w/3),e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),me(u.col,0,g/2,-w/3),n.push.apply(n,Object(ee.a)(u.col));var l=Ne({});return me(l.v,0,-g/2,0),e.push.apply(e,Object(ee.a)(l.v)),t.push.apply(t,Object(ee.a)(l.c)),a.push.apply(a,Object(ee.a)(l.u)),{v:e,c:t,u:a,col:n}},Xe=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g/2,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g/2,0),n.push.apply(n,Object(ee.a)(s.col));var i=Ie({});me(i.v,0,g/2,w/3),e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),me(i.col,0,g/2,w/3),n.push.apply(n,Object(ee.a)(i.col));var c=Ie({});me(c.v,0,g/2,-w/3),e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),me(c.col,0,g/2,-w/3),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({w:w/3,d:w/3});me(p.v,w/3,g/2,0),e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),me(p.col,w/3,g/2,0),n.push.apply(n,Object(ee.a)(p.col));var u=ke({});return be(u.v,-Math.PI/2),me(u.v,-w/6,g/2,0),e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),be(u.col,-Math.PI/2),me(u.col,-w/6,g/2,0),n.push.apply(n,Object(ee.a)(u.col)),{v:e,c:t,u:a,col:n}},Le=w/6,Ye=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g,0),n.push.apply(n,Object(ee.a)(s.col));var i=Ie({nX_pZ:[-Le,0,-Le],pX_pZ:[Le,0,-Le],pX_nZ:[Le,g/2,-80],nX_nZ:[-Le,g/2,-80]});e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),n.push.apply(n,Object(ee.a)(i.col));var c=Ie({nX_pZ:[Le,g,Le],pX_pZ:[w/2,g/2,Le],pX_nZ:[w/2,g/2,-Le],nX_nZ:[Le,g,-Le]});e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({nX_pZ:[-Le,g/2,w/2],pX_pZ:[Le,g/2,w/2],pX_nZ:[Le,0,Le],nX_nZ:[-Le,0,Le]});e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),n.push.apply(n,Object(ee.a)(p.col));var u=Ie({nX_pZ:[-w/2,g/2,Le],pX_pZ:[-Le,g,Le],pX_nZ:[-Le,g,-Le],nX_nZ:[-w/2,g/2,-Le]});e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),n.push.apply(n,Object(ee.a)(u.col));var l=Ne({});return e.push.apply(e,Object(ee.a)(l.v)),t.push.apply(t,Object(ee.a)(l.c)),a.push.apply(a,Object(ee.a)(l.u)),{v:e,c:t,u:a,col:n}},Fe=w/6,Ee=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g,0),n.push.apply(n,Object(ee.a)(s.col));var i=Ie({nX_pZ:[-Fe,0,-Fe],pX_pZ:[Fe,0,-Fe],pX_nZ:[Fe,g/4,-60],nX_nZ:[-Fe,g/4,-60]});e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),n.push.apply(n,Object(ee.a)(i.col));var c=Ie({nX_pZ:[-Fe,g/4,-60],pX_pZ:[Fe,g/4,-60],pX_nZ:[Fe,g/4,-80],nX_nZ:[-Fe,g/4,-80]});e.push.apply(e,Object(ee.a)(c.v)),t.push.apply(t,Object(ee.a)(c.c)),a.push.apply(a,Object(ee.a)(c.u)),n.push.apply(n,Object(ee.a)(c.col));var p=Ie({nX_pZ:[2*-Fe,g/2.5,-60],pX_pZ:[-Fe,g/4,-60],pX_nZ:[-Fe,g/4,-80],nX_nZ:[2*-Fe,g/2.5,-80]});e.push.apply(e,Object(ee.a)(p.v)),t.push.apply(t,Object(ee.a)(p.c)),a.push.apply(a,Object(ee.a)(p.u)),n.push.apply(n,Object(ee.a)(p.col));var u=Ie({nX_pZ:[-80,g/2.5,-60],pX_pZ:[2*-Fe,g/2.5,-60],pX_nZ:[2*-Fe,g/2.5,-80],nX_nZ:[-80,g/2.5,-80]});e.push.apply(e,Object(ee.a)(u.v)),t.push.apply(t,Object(ee.a)(u.c)),a.push.apply(a,Object(ee.a)(u.u)),n.push.apply(n,Object(ee.a)(u.col));var l=Ie({nX_pZ:[-80,g/2,-Fe],pX_pZ:[2*-Fe,g/2,-Fe],pX_nZ:[2*-Fe,g/2.5,-60],nX_nZ:[-80,g/2.5,-60]});e.push.apply(e,Object(ee.a)(l.v)),t.push.apply(t,Object(ee.a)(l.c)),a.push.apply(a,Object(ee.a)(l.u)),n.push.apply(n,Object(ee.a)(l.col));var h=Ie({nX_pZ:[-80,g/2,Fe],pX_pZ:[2*-Fe,g/2,Fe],pX_nZ:[2*-Fe,g/2,-Fe],nX_nZ:[-80,g/2,-Fe]});e.push.apply(e,Object(ee.a)(h.v)),t.push.apply(t,Object(ee.a)(h.c)),a.push.apply(a,Object(ee.a)(h.u)),n.push.apply(n,Object(ee.a)(h.col));var d=Ie({nX_pZ:[-80,.75*g,2*Fe],pX_pZ:[2*-Fe,.75*g,2*Fe],pX_nZ:[2*-Fe,g/2,Fe],nX_nZ:[-80,g/2,Fe]});e.push.apply(e,Object(ee.a)(d.v)),t.push.apply(t,Object(ee.a)(d.c)),a.push.apply(a,Object(ee.a)(d.u)),n.push.apply(n,Object(ee.a)(d.col));var b=Ie({nX_pZ:[-80,.75*g,80],pX_pZ:[2*-Fe,.75*g,80],pX_nZ:[2*-Fe,.75*g,2*Fe],nX_nZ:[-80,.75*g,2*Fe]});e.push.apply(e,Object(ee.a)(b.v)),t.push.apply(t,Object(ee.a)(b.c)),a.push.apply(a,Object(ee.a)(b.u)),n.push.apply(n,Object(ee.a)(b.col));var m=Ie({nX_pZ:[2*-Fe,.75*g,80],pX_pZ:[-Fe,.85*g,80],pX_nZ:[-Fe,.85*g,2*Fe],nX_nZ:[2*-Fe,.75*g,2*Fe]});e.push.apply(e,Object(ee.a)(m.v)),t.push.apply(t,Object(ee.a)(m.c)),a.push.apply(a,Object(ee.a)(m.u)),n.push.apply(n,Object(ee.a)(m.col));var y=Ie({nX_pZ:[-Fe,.85*g,80],pX_pZ:[Fe,.85*g,80],pX_nZ:[Fe,.85*g,2*Fe],nX_nZ:[-Fe,.85*g,2*Fe]});e.push.apply(e,Object(ee.a)(y.v)),t.push.apply(t,Object(ee.a)(y.c)),a.push.apply(a,Object(ee.a)(y.u)),n.push.apply(n,Object(ee.a)(y.col));var f=Ie({nX_pZ:[-Fe,.85*g,2*Fe],pX_pZ:[Fe,.85*g,2*Fe],pX_nZ:[Fe,g,Fe],nX_nZ:[-Fe,g,Fe]});e.push.apply(e,Object(ee.a)(f.v)),t.push.apply(t,Object(ee.a)(f.c)),a.push.apply(a,Object(ee.a)(f.u)),n.push.apply(n,Object(ee.a)(f.col));var O=Ne({});return e.push.apply(e,Object(ee.a)(O.v)),t.push.apply(t,Object(ee.a)(O.c)),a.push.apply(a,Object(ee.a)(O.u)),{v:e,c:t,u:a,col:n}},De=w/6,Ae=function(){var e=[],t=[],a=[],n=[],o=ge({}),r=function(r,s){var i=Object(ee.a)(o.v);me(i,r,0,s),e.push.apply(e,Object(ee.a)(i));var c=Object(ee.a)(o.col);me(c,r,0,s),n.push.apply(n,Object(ee.a)(c)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u))};r(-w/3/2,-w/3/2),r(w/3/2,-w/3/2),r(-w/3/2,w/3/2),r(w/3/2,w/3/2);var s=Ie({});me(s.v,0,g,0),e.push.apply(e,Object(ee.a)(s.v)),t.push.apply(t,Object(ee.a)(s.c)),a.push.apply(a,Object(ee.a)(s.u)),me(s.col,0,g,0),n.push.apply(n,Object(ee.a)(s.col));var i=Ie({nX_pZ:[-De,0,80],pX_pZ:[De,0,80],pX_nZ:[De,.5*g,De],nX_nZ:[-De,.5*g,De]});return me(i.v,0,.5*g,0),e.push.apply(e,Object(ee.a)(i.v)),t.push.apply(t,Object(ee.a)(i.c)),a.push.apply(a,Object(ee.a)(i.u)),me(i.col,0,.5*g,0),n.push.apply(n,Object(ee.a)(i.col)),{v:e,c:t,u:a,col:n}},Re=w/6,Ge=function(){var e=[],t=[],a=[],n=[],o=Ie({nX_pZ:[-Re,0,-Re],pX_pZ:[Re,0,-Re],pX_nZ:[Re,g/2,-80],nX_nZ:[-Re,g/2,-80]});return e.push.apply(e,Object(ee.a)(o.v)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u)),n.push.apply(n,Object(ee.a)(o.col)),{v:e,c:t,u:a,col:n}},Be=function(){var e=[],t=[],a=[],n=[],o=Ie({});me(o.v,0,g,0),e.push.apply(e,Object(ee.a)(o.v)),t.push.apply(t,Object(ee.a)(o.c)),a.push.apply(a,Object(ee.a)(o.u)),me(o.col,0,g,0),n.push.apply(n,Object(ee.a)(o.col));var r=Ne({});return e.push.apply(e,Object(ee.a)(r.v)),t.push.apply(t,Object(ee.a)(r.c)),a.push.apply(a,Object(ee.a)(r.u)),{v:e,c:t,u:a,col:n}},ze=function(e){var t=e.v,a=e.c,n=void 0===a?null:a,o=e.u,r=void 0===o?null:o,s=(e.col,new u.h),i=new Float32Array(t);if(s.setAttribute("position",new u.g(i,3)),n){var c=new Float32Array(n);s.setAttribute("color",new u.g(c,3))}if(r){var p=new Float32Array(r);s.setAttribute("uv",new u.g(p,2))}return s.computeVertexNormals(),s},qe=function(e){var t=function(){var e=[];e.push({sideNX:"_",sidePX:"_",sideNY:"_",sidePY:"_",sideNZ:"_",sidePZ:"_",keyModel:"empty",rotationY:0}),e.push({sideNX:"_",sidePX:"_",sideNY:"_",sidePY:"_",sideNZ:"I",sidePZ:"I",keyModel:"tile_I",rotationY:0});var t={sideNX:"I",sidePX:"I",sideNY:"_",sidePY:"_",sideNZ:"_",sidePZ:"_",keyModel:"t_I",rotationY:Math.PI/2};e.push(t),e.push({sideNX:"_",sidePX:"I",sideNY:"_",sidePY:"_",sideNZ:"_",sidePZ:"_",keyModel:"t_L",rotationY:0});var a={sideNX:"I",sidePX:"_",sideNY:"_",sidePY:"_",sideNZ:"_",sidePZ:"I",keyModel:"t_L",rotationY:-Math.PI/2};e.push(a);var n={sideNX:"I",sidePX:"_",sideNY:"_",sidePY:"_",sideNZ:"I",sidePZ:"_",keyModel:"t_L",rotationY:-Math.PI};e.push(n);var o={sideNX:"_",sidePX:"I",sideNY:"_",sidePY:"_",sideNZ:"I",sidePZ:"_",keyModel:"t_L",rotationY:1.5*-Math.PI};e.push(o),e.push({sideNX:"I",sidePX:"_",sideNY:"I.closed.NZ",sidePY:"I.PZ",sideNZ:"_",sidePZ:"_",keyModel:"t_stairs",rotationY:0});var r={sideNX:"_",sidePX:"_",sideNY:"I.closed.PX",sidePY:"I.NX",sideNZ:"I",sidePZ:"_",keyModel:"t_stairs",rotationY:-Math.PI/2};e.push(r);var s={sideNX:"_",sidePX:"I",sideNY:"I.closed.PZ",sidePY:"I.NZ",sideNZ:"_",sidePZ:"_",keyModel:"t_stairs",rotationY:Math.PI};e.push(s);var i={sideNX:"_",sidePX:"_",sideNY:"I.closed.NX",sidePY:"I.PX",sideNZ:"_",sidePZ:"I",keyModel:"t_stairs",rotationY:1.5*-Math.PI};e.push(i),e.push({sideNX:"_",sidePX:"_",sideNY:"I.closed.NZ",sidePY:"_",sideNZ:"I",sidePZ:"_",keyModel:"t_fromBottom",rotationY:0});var c={sideNX:"_",sidePX:"I",sideNY:"I.closed.PX",sidePY:"_",sideNZ:"_",sidePZ:"_",keyModel:"t_fromBottom",rotationY:-Math.PI/2};e.push(c),e.push({sideNX:"_",sidePX:"_",sideNY:"_",sidePY:"I.PZ",sideNZ:"_",sidePZ:"I",keyModel:"t_toTopPlatform",rotationY:0});var p={sideNX:"I",sidePX:"_",sideNY:"_",sidePY:"I.NX",sideNZ:"_",sidePZ:"_",keyModel:"t_toTopPlatform",rotationY:-Math.PI/2};e.push(p);var u={sideNX:"_",sidePX:"_",sideNY:"_",sidePY:"I.NZ",sideNZ:"I",sidePZ:"_",keyModel:"t_toTopPlatform",rotationY:-Math.PI};e.push(u),e.push({sideNX:"_",sidePX:"I",sideNY:"_",sidePY:"_",sideNZ:"I",sidePZ:"I",keyModel:"t_T",rotationY:0}),e.push({sideNX:"_",sidePX:"_",sideNY:"_",sidePY:"I",sideNZ:"_",sidePZ:"_",keyModel:"t_tt",rotationY:0}),e.push({sideNX:"I",sidePX:"I",sideNY:"_",sidePY:"_",sideNZ:"I",sidePZ:"I",keyModel:"t_X",rotationY:0}),e.push({sideNX:"I",sidePX:"I",sideNY:"I.closed.NZ.PZ.",sidePY:"I.NX.PX",sideNZ:"I",sidePZ:"I",keyModel:"t_XY",rotationY:0});var l={sideNX:"I",sidePX:"I",sideNY:"I.closed.NX.PX",sidePY:"I.NZ.PZ",sideNZ:"I",sidePZ:"I",keyModel:"t_XY",rotationY:-Math.PI/2};e.push(l);for(var h=[],d=0;d<e.length;++d)e[d].id=d,h.push(e[d]);return function(e){for(var t=0;t<e.length;++t)e[t].canConnectNX=[],e[t].canConnectPX=[],e[t].canConnectNY=[],e[t].canConnectPY=[],e[t].canConnectNZ=[],e[t].canConnectPZ=[];for(var a=0;a<e.length;++a)for(var n=0;n<e.length;++n)e[a].sideNX===e[n].sidePX&&e[a].canConnectNX.push(e[n].id),e[a].sidePX===e[n].sideNX&&e[a].canConnectPX.push(e[n].id),e[a].sideNY===e[n].sidePY?e[a].canConnectNY.push(e[n].id):(e[a].sideNY.includes("I")&&"I"===e[n].sidePY&&e[a].canConnectNY.push(e[n].id),"I"===e[a].sideNY&&e[n].sidePY.includes("I")&&e[a].canConnectNY.push(e[n].id),"I"!==e[a].sideNY&&"I"!==e[n].sidePY&&e[a].sideNY.includes("I")&&e[n].sidePY.includes("I")&&function(){var t=e[a].sideNY.split("."),o=e[n].sidePY.split("."),r=!0;t.map((function(e){"I"!==e&&"closed"!==e&&o.map((function(t){e===t&&(r=!1)}))})),r&&e[a].canConnectNY.push(e[n].id)}()),e[a].sidePY===e[n].sideNY?e[a].canConnectPY.push(e[n].id):(e[a].sidePY.includes("I")&&"I"===e[n].sideNY&&e[a].canConnectPY.push(e[n].id),"I"===e[a].sidePY&&e[n].sideNY.includes("I")&&e[a].canConnectPY.push(e[n].id),"I"!==e[a].sidePY&&"I"!==e[n].sideNY&&e[a].sidePY.includes("I")&&e[n].sideNY.includes("I")&&function(){var t=e[n].sideNY.split("."),o=e[a].sidePY.split("."),r=!0;t.map((function(e){"I"!==e&&"closed"!==e&&o.map((function(t){e===t&&(r=!1)}))})),r&&e[a].canConnectPY.push(e[n].id)}()),e[a].sideNZ===e[n].sidePZ&&e[a].canConnectNZ.push(e[n].id),e[a].sidePZ===e[n].sideNZ&&e[a].canConnectPZ.push(e[n].id)}(h),h}(),a=ne(t),n=function(e){var t,a,n=e.materials,o=n.structureMaterial,r=n.basicMat,s={t_stairs:Ee(),t_XY:Ye(),t_fromBottom:Ge(),t_T:Xe(),t_toTopPlatform:Ae(),t_L:Me(),t_I:Ze(),t_X:Te(),t_tt:Be()};return{generateMeshes:function(n,i){var c={};for(var p in s){c[p]=[];for(var l=0;l<s[p].c.length;l+=3){var h;(h=c[p]).push.apply(h,Object(ee.a)(i.COLOR_00))}}return new Promise((function(p){var l=[],h=[],d=[],b=[];n.iterateAll((function(e){if(e.tileData){var t=e.i,a=e.j,n=e.k,o=e.tileData;if(s[e.tileData.keyModel]){var r=Object(ee.a)(s[o.keyModel].v);be(r,o.rotationY),me(r,w*n,g*t,w*a),l.push.apply(l,Object(ee.a)(r)),h.push.apply(h,Object(ee.a)(c[o.keyModel])),d.push.apply(d,Object(ee.a)(s[o.keyModel].u));var i=Object(ee.a)(s[o.keyModel].col);be(i,o.rotationY),me(i,w*n,g*t,w*a),b.push.apply(b,Object(ee.a)(i))}}}));var m=i.X,y=i.Y,f=i.Z,O=ze({v:l,c:h,u:d});(t=new u.O(O,i.mat?e.materials[i.mat]:o)).position.set(m,y,f),e.studio.addToScene(t);var v=ze({v:b});(a=new u.O(v,r)).position.set(m,y,f),e.studio.addToScene(a),a.visible=!1,e.system_PlayerMoveOnLevel.addItemToPlayerCollision(a),p()}))},setPosition:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.position.set(e,a,n)},destroyStructure:function(){e.studio.removeFromScene(t),t.geometry.dispose(),e.studio.removeFromScene(a),e.system_PlayerMoveOnLevel.removeItemFromPlayerCollision(a),a.geometry.dispose()}}}(e),o=null;return{generateStructure:function(e){return new Promise((function(t){a.generateMap(e).then((function(a){o=a,console.log("map",o),n.generateMeshes(o,e).then((function(e){t()}))}))}))},generateStructureFinal:function(e,t){return new Promise((function(a){n.generateMeshes(e,t).then((function(e){a()}))}))},destroyStructure:function(){a.destroyMap(),n.destroyStructure()},getCoordsForItem:function(e){var t,a,n,r=100;return function e(){var s=Math.floor(Math.random()*(o.sizeY-2)+1),i=Math.floor(Math.random()*o.sizeZ),c=Math.floor(Math.random()*o.sizeX);--r,o.items[s][i][c]&&o.items[s][i][c].tileData&&(r<0||"t_L"===o.items[s][i][c].tileData.keyModel||"t_T"===o.items[s][i][c].tileData.keyModel||"t_I"===o.items[s][i][c].tileData.keyModel||"t_X"===o.items[s][i][c].tileData.keyModel)?(a=s,t=c,n=i):e()}(),[t,a,n]}}},We=function(e){for(var t=[],a=0;a<20;++a)for(var n=300*Math.random(),o=300*Math.random()-100,r=300*Math.random(),s=0;s<3;++s)t.push(n+5*Math.random(),o+5*Math.random(),r+5*Math.random());var i=new Float32Array(t),c=new u.h;return c.setAttribute("position",new u.g(i,3)),new u.O(c,e)},Ue=(Math.sin,Math.cos,function(e){var t=e.materials,a=t.structureMaterial,n=t.basicMat,o=[],r=[],s=[],i=[],c=Ie({nX_pZ:[-50,0,125],pX_pZ:[50,0,125],pX_nZ:[50,0,-125],nX_nZ:[-50,0,-125],color:[1,1,0]});o.push.apply(o,Object(ee.a)(c.v)),r.push.apply(r,Object(ee.a)(c.c)),s.push.apply(s,Object(ee.a)(c.u)),i.push.apply(i,Object(ee.a)(c.col));var p=function(e){e.h,e.h0,e.h00,e.w0,e.w,e.h1,e.h11,e.w1,e.h2,e.bottomH,e.topH;var t=e.color,a=[],n=[],o=[],r=[],s=de(void 0===t?k:t);return a.push.apply(a,Object(ee.a)(le([-15,0,5],[15,0,5],[15,11,2],[-15,11,2]))),o.push.apply(o,Object(ee.a)(Oe.empty)),n.push.apply(n,Object(ee.a)(s)),a.push.apply(a,Object(ee.a)(le([-15,0,-2],[-15,0,5],[-15,11,2],[-15,11,-2]))),o.push.apply(o,Object(ee.a)(Oe.empty)),n.push.apply(n,Object(ee.a)(s)),a.push.apply(a,Object(ee.a)(le([15,0,5],[15,0,-2],[15,11,-2],[15,11,2]))),o.push.apply(o,Object(ee.a)(Oe.empty)),n.push.apply(n,Object(ee.a)(s)),a.push.apply(a,Object(ee.a)(le([15,0,-2],[-15,0,-2],[-15,11,-2],[15,11,-2]))),o.push.apply(o,Object(ee.a)(Oe.empty)),n.push.apply(n,Object(ee.a)(s)),a.push.apply(a,Object(ee.a)(le([-15,11,2],[15,11,2],[15,11,-2],[-15,11,-2]))),o.push.apply(o,Object(ee.a)(Oe.empty)),n.push.apply(n,Object(ee.a)(s)),r.push.apply(r,Object(ee.a)(le([-15,0,2],[15,0,2],[15,30,2],[-15,20,2]))),{v:a,col:r,u:o,c:n}}({h:12,color:[1,1,0]});me(p.v,0,0,-110),o.push.apply(o,Object(ee.a)(p.v)),r.push.apply(r,Object(ee.a)(p.c)),s.push.apply(s,Object(ee.a)(p.u)),me(p.col,0,0,-110),i.push.apply(i,Object(ee.a)(p.col));var l=ze({v:o,c:r,u:s}),h=new u.O(l,a);e.studio.addToScene(h);var d=ze({v:i}),b=new u.O(d,n);b.visible=!1,h.add(b),e.system_PlayerMoveOnLevel.addItemToPlayerCollision(b),e.system_PlayerMoveOnLevel.addItemToPlayerCollisionWalls(b);var m=new u.Y;m.position.set(0,10,-100),h.add(m);var y=new u.O(new u.bb(1,6,1,1),new u.P({color:0}));return y.rotation.x=-.25,y.position.z=-106,y.position.y=5,h.add(y),{arrow:y,mesh:h,objectForCheck:m}}),Ve=Math.sin,He=Math.cos,Ke=function(e){var t=e.materials,a=t.structureMaterial,n=(t.basicMat,[]),o=[],r=[],s=[],i=function(e){e.h,e.h0,e.h00,e.w0,e.w,e.h1,e.h11,e.w1,e.h2,e.bottomH,e.topH;for(var t=e.color,a=[],n=[],o=[],r=de(void 0===t?k:t),s=[[7,0],[7,20,"empty"],[0,21,"empty"]],i=1;i<s.length;++i)for(var c=s[i-1][0],p=s[i][0],u=0;u<8;++u){var l=(u-1)/8*Math.PI*2;0===u&&(l=7/8*Math.PI*2);var h=u/8*Math.PI*2;a.push.apply(a,Object(ee.a)(le([Ve(l)*c,s[i-1][1],He(l)*c],[Ve(h)*c,s[i-1][1],He(h)*c],[Ve(h)*p,s[i][1],He(h)*p],[Ve(l)*p,s[i][1],He(l)*p]))),o.push.apply(o,Object(ee.a)(Oe[s[i][2]])),n.push.apply(n,Object(ee.a)(r))}return{v:a,col:[],u:o,c:n}}({h:12,color:[1,1,0]});n.push.apply(n,Object(ee.a)(i.v)),o.push.apply(o,Object(ee.a)(i.c)),r.push.apply(r,Object(ee.a)(i.u)),s.push.apply(s,Object(ee.a)(i.col));var c=ze({v:n,c:o,u:r}),p=new u.O(c,a);return{mesh:p,objectForCheck:p}},$e=function(){function e(t){var a=this;Object(N.a)(this,e),this._root=t;var n=t.emitter,o=t.player;this._itemsToCheck=[];var r=new u.xb;n.subscribe("playerMove")((function(){for(var e=0;e<a._itemsToCheck.length;++e){a._itemsToCheck[e].getWorldPosition(r);var t=o.mesh.position.distanceTo(r);if(!a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<a._itemsToCheck[e].userData.nearPlayerItemNear)return a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void n.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>a._itemsToCheck[e].userData.nearPlayerItemNear&&(a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,n.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(Z.a)(e,[{key:"setItemToCheck",value:function(e,t,a,n){for(var o=0;o<this._itemsToCheck.length;++o)if(e===this._itemsToCheck[o])return;t&&(e.userData.nearPlayerItemKey=t),a&&(e.userData.nearPlayerItemNear=a),n&&(e.userData.nearPlayerItemFar=n),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),Je=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Qe=function(e){var t=e.flyer,a=e.frameUpdater;e.system_Sound;return new Promise((function(e){var n=0,o=a.on((function(e){t.mesh.position.z+=n})),r={spd:0};new G.b(r).to({spd:-20},5e3).onUpdate((function(){n=r.spd})).onComplete((function(){o(),e()})).start()}))},et=function(e,t){return new Promise((function(a){var n=e.flyer,o=e.frameUpdater.on((function(e){n.mesh.position.z+=-20*e.count,n.mesh.position.z<t&&(o(),a())}))}))},tt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,a=e.flyer;return new Promise((function(e){var n={z:a.mesh.position.z};new G.b(n).easing(G.a.Quadratic.Out).to({z:t},1e3).onUpdate((function(){a.mesh.position.z=n.z})).onComplete(e).start()}))},at=function(){var e=document.createElement("div");e.style.backgroundColor="#ffff00",e.style.minHeight="15px",e.style.minWidth="1px",e.style.position="absolute",e.style.right="15px",e.style.top="65px",e.classList.add("fuel-bar"),document.querySelector(".canvas-wrapper").appendChild(e);var t={w:0};new G.b(t).to({w:250},2e3).onUpdate((function(){e.style.minWidth=t.w+"px"})).start()},nt=function(e){return new Promise((function(t){var a=e.system_PlayerNearLevelItems,n=e.emitter,o=e.fuel;a.setItemToCheck(o.mesh,"nearFuel",30,30);var r=n.subscribe("checkNear")((function(e){"nearFuel"===e.item&&(r(),a.removeItemFromCheck(o.mesh),t())}))}))},ot=function(e){return new Promise((function(t){var a=e.flyer,n=e.system_PlayerNearLevelItems,o=e.emitter;e.frameUpdater,e.fuel;n.setItemToCheck(a.objectForCheck,"platformObjectForCheck",20,30);var r=o.subscribe("checkNear")((function(o){"platformObjectForCheck"===o.item&&(n.removeItemFromCheck(a.objectForCheck),r(),function(e){var t=document.querySelector(".fuel-bar"),a={w:0};new G.b(a).to({w:1},2e3).onUpdate((function(){t.style.minWidth=250*(1-a.w)+"px",e.flyer.arrow.rotation.z=(1-a.w)*(Math.PI/2)})).onComplete((function(){t.parentNode.removeChild(t),t.remove()})).start()}(e),setTimeout(t,2e3))}))}))},rt=1;function st(){return(st=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,i,c,p,u,l,h,d,b,m,y;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.flyer,o=t.structure,s=t.dispatcher,i=t.system_PlayerNearLevelItems,c=t.player,p=t.studio,u=t.emitter,l=t.frameUpdater,h=t.fuel,d=t.system_Sound,e.next=3,Je(20);case 3:if(M[rt]){e.next=5;break}return e.abrupt("return",void a());case 5:return i.removeItemFromCheck(n.objectForCheck),c.mesh.position.sub(n.mesh.position),n.mesh.add(t.player.mesh),8e3,b=l.on((function(e){n.arrow.rotation.z=Math.abs(n.mesh.position.z)/8e3*(Math.PI/4)})),d.startCar(),e.next=13,Qe(t);case 13:return p.changeFog(Object(D.a)(Object(D.a)({},M[rt-1].FOG),{},{color:M[rt-1].ENV_COLOR})),e.next=16,et(t,-8e3);case 16:return p.changeEnvColor(M[rt].ENV_COLOR),e.next=19,Je(3e3);case 19:return b(),c.toggleBlocked=!0,u.emit("keyEvent")({up:!1,down:!1,left:!1,right:!1,p:!1}),o.destroyStructure(),e.next=25,o.generateStructure(M[rt]);case 25:return m=o.getCoordsForItem("easyItem"),t.studio.addToScene(h.mesh),h.mesh.position.set(m[0]*w+M[rt].X,m[1]*g+M[rt].Y+g/2,m[2]*w+M[rt].Z),e.next=30,Je(200);case 30:return n.mesh.position.z=8e3,8e3,y=l.on((function(e){n.arrow.rotation.z=(8e3-n.mesh.position.z)/8e3*(Math.PI/4)+Math.PI/4})),c.toggleBlocked=!1,setTimeout((function(){return p.changeFog(M[rt].FOG)}),1e3),e.next=37,et(t,1e3);case 37:return e.next=39,tt(t);case 39:return d.stopCar(),y(),s.dispatch({type:"CLICK_DRAW"}),c.mesh.position.add(n.mesh.position),p.addToScene(t.player.mesh),e.next=46,nt(t);case 46:return at(),p.removeFromScene(h.mesh),e.next=50,ot(t);case 50:i.setItemToCheck(n.objectForCheck,"platformObjectForCheck",20,30),ct(t),++rt;case 53:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(){return(it=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,c,p,l,h,d,f,O,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.flyer,n=t.structure,o=t.dispatcher,s=t.system_PlayerNearLevelItems,i=t.player,c=t.studio,p=t.emitter,l=t.frameUpdater,t.fuel,h=t.system_Sound,e.next=3,Je(20);case 3:return s.removeItemFromCheck(a.objectForCheck),o.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),i.mesh.position.sub(a.mesh.position),a.mesh.add(t.player.mesh),8e3,d=l.on((function(e){a.arrow.rotation.z=Math.abs(a.mesh.position.z)/8e3*(Math.PI/4)})),h.startCar(),e.next=12,Qe(t);case 12:return c.changeFog(Object(D.a)(Object(D.a)({},M[rt-1].FOG),{},{color:M[rt-1].ENV_COLOR})),e.next=15,et(t,-8e3);case 15:return c.changeEnvColor(m),e.next=18,Je(3e3);case 18:return d(),i.toggleBlocked=!0,p.emit("keyEvent")({up:!1,down:!1,left:!1,right:!1,p:!1}),n.destroyStructure(),e.next=24,n.generateStructureFinal(b,y);case 24:return e.next=26,Je(200);case 26:return a.mesh.position.z=8e3,8e3,f=l.on((function(e){a.arrow.rotation.z=(8e3-a.mesh.position.z)/8e3*(Math.PI/4)+Math.PI/4})),i.toggleBlocked=!1,setTimeout((function(){return c.changeFog(y.FOG)}),1e3),e.next=33,et(t,1e3);case 33:return e.next=35,tt(t);case 35:h.stopCar(),t.studio.addToScene(t.finalItem.mesh),t.finalItem.mesh.position.set(-960,-70,160),t.system_PlayerMoveOnLevel.addItemToPlayerCollisionWalls(t.finalItem.mesh),f(),o.dispatch({type:"CLICK_DRAW"}),i.mesh.position.add(a.mesh.position),c.addToScene(t.player.mesh),(O=new u.Y).position.set(-960,-800,160),c.addToScene(O),s.setItemToCheck(O,"endGame",400,400),v=!1,l.on((function(e){i.mesh.position.y<-400&&!v&&(v=!0,c.changeFog({color:2098986,near:1,far:5,time:3e3}),setTimeout((function(){t.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"}),t.system_PlayerMoveOnLevel.isFreeze=!0,t.player.controls&&(t.player.controlsUnlock(),setTimeout((function(){t.buttonMouse.style.display="none"}),1e3))}),5e3))}));case 49:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=function(e){(function(e,t){return st.apply(this,arguments)})(e,(function(){(function(e){return it.apply(this,arguments)})(e).then()})).then()},pt=a(23),ut=80,lt=160,ht=81,dt=3e3,bt=function(e){var t=e.materials,a=(t.structureMaterial,t.basicMat,t.matNotFog),n=t.matNotFogOuter,o=[],r=[],s=[],i=[],c=[],p=function(e){Object(pt.a)(e);for(var t=[],a=[],n=[],o=de(y.COLOR_00),r=Object(ee.a)(o),s=0;s<20;++s)t.push.apply(t,Object(ee.a)(le([-ut,-lt-s*lt,-ut],[ut,-lt-s*lt,-ut],[ut,-s*lt,-ut],[-ut,-s*lt,-ut]))),a.push.apply(a,Object(ee.a)(r)),n.push.apply(n,Object(ee.a)(Oe.lines)),t.push.apply(t,Object(ee.a)(le([-ut,-lt-s*lt,ut],[-ut,-lt-s*lt,-ut],[-ut,-s*lt,-ut],[-ut,-s*lt,ut]))),a.push.apply(a,Object(ee.a)(r)),n.push.apply(n,Object(ee.a)(Oe.lines)),t.push.apply(t,Object(ee.a)(le([ut,-lt-s*lt,-ut],[ut,-lt-s*lt,ut],[ut,-s*lt,ut],[ut,-s*lt,-ut]))),a.push.apply(a,Object(ee.a)(r)),n.push.apply(n,Object(ee.a)(Oe.lines)),t.push.apply(t,Object(ee.a)(le([ut,-lt-s*lt,ut],[-ut,-lt-s*lt,ut],[-ut,-s*lt,ut],[ut,-s*lt,ut]))),a.push.apply(a,Object(ee.a)(r)),n.push.apply(n,Object(ee.a)(Oe.lines));var i=[];return i.push.apply(i,Object(ee.a)(le([ht,-dt,-81],[-81,-dt,-81],[-81,0,-81],[ht,0,-81]))),i.push.apply(i,Object(ee.a)(le([-81,-dt,-81],[-81,-dt,ht],[-81,0,ht],[-81,0,-81]))),i.push.apply(i,Object(ee.a)(le([-81,-dt,ht],[ht,-dt,ht],[ht,0,ht],[-81,0,ht]))),i.push.apply(i,Object(ee.a)(le([ht,-dt,ht],[ht,-dt,-81],[ht,0,-81],[ht,0,ht]))),{v:t,col:[],u:n,c:a,v2:i}}({});o.push.apply(o,Object(ee.a)(p.v)),r.push.apply(r,Object(ee.a)(p.v2)),s.push.apply(s,Object(ee.a)(p.c)),i.push.apply(i,Object(ee.a)(p.u)),c.push.apply(c,Object(ee.a)(p.col));var l=ze({v:o,c:s,u:i}),h=new u.O(l,a),d=ze({v:r}),b=new u.O(d,n);return h.add(b),{mesh:h,objectForCheck:h}},mt=a(6),yt=a(16),ft=a.n(yt),Ot=a(8),vt=(a(38),"en"),jt=function(e){return function(t){return e[vt]&&e[vt][t]||t}},_t=a(4),wt=jt({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a",Machine:"\u041c\u0430\u0448\u0438\u043d\u0430",Rooms:"\u041a\u043e\u043c\u043d\u0430\u0442\u044b",Platform:"\u041f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),gt=Object(Ot.b)((function(e){return Object(D.a)({},e.controls.infoPanelData)}))((function(e){return Object(_t.jsxs)("div",{className:"info",children:[Object(_t.jsx)("button",{className:"control-small butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),Object(_t.jsxs)("div",{className:"info-inner",children:[Object(_t.jsx)("p",{children:wt(e.title)}),Object(_t.jsx)("p",{children:wt(e.topText)}),Object(_t.jsx)("ul",{children:e.chapters.map((function(t,a){return Object(_t.jsxs)("li",{children:[a+1,".\xa0",t.href?Object(_t.jsx)("span",{children:Object(_t.jsx)("a",{href:t.href,target:"blank",children:wt(t.text)})}):Object(_t.jsx)("span",{children:wt(t.text)}),a===e.currentChapterIndex&&wt(" (current)")]},a)}))}),Object(_t.jsx)("p",{children:e.bottomText}),Object(_t.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(_t.jsxs)("li",{children:[wt(e.text),Object(_t.jsx)("a",{href:e.href,target:"blank",children:wt(e.aText)})]},t)}))})]})]})})),Ct=(a(40),Object(Ot.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(mt.useState)(!0),a=Object($.a)(t,2),n=a[0],o=a[1];return Object(mt.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&o(!0)}))})),Object(_t.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(_t.jsx)("button",{className:"".concat(e.isMute?"butt-sound-n":"butt-sound"," control-small"),onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})}}),e.isShowControls&&Object(_t.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")}}),e.isShowControls&&Object(_t.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")}}),e.isShowControls&&Object(_t.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")}}),e.isShowControls&&Object(_t.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")}}),e.isShowControls&&n&&Object(_t.jsx)("button",{className:"butt-fullscreen control-small",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),o(!1)}}),!e.isInfo&&Object(_t.jsx)("button",{className:"butt-info control-small",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),e.isInfo&&Object(_t.jsx)(gt,{})]})})));var It={dispatch:null},Pt=Object(Ot.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!It.dispatch&&(It.dispatch=e.dispatch),Object(_t.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(_t.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(_t.jsx)(Ct,{gameContext:e.gameContext})]})})),kt=a(14),Mt=a(25),St={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../01"},{text:"Brige",href:"./../02"},{text:"Cube",href:"./../03"},{text:"Endways",href:"./../04"},{text:"Machine",href:"./../05"},{text:"Rooms",href:"./../06"},{text:"Platform",href:"./../07"},{text:"Struct",href:"./../08"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"otrisovano.ru",href:"https://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var xt=document.querySelector(".progress"),Nt=-100,Zt=!0;!function e(){Zt&&setTimeout((function(){0===++Nt&&(Nt-=100),xt.style.marginLeft=Nt+"%",e()}),30)}();var Tt=function(){function e(t){Object(N.a)(this,e),t.dispatcher=It,this._root=t;var a=function(e){e.customStore||(e.customStore={});var t=Object(kt.b)(Object(D.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:St,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(D.a)(Object(D.a)({},e),{},{infoPanelData:Object(D.a)(Object(D.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(D.a)(Object(D.a)({},e),{},{isMute:t.is}):Object(D.a)({},e)}},e.customStore)),a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||kt.c;return Object(kt.d)(t,a(Object(kt.a)(Mt.a)))}(t);a&&ft.a.render(Object(_t.jsx)(Ot.a,{store:a,children:Object(_t.jsx)(Pt,{gameContext:t})}),document.getElementById("root"))}return Object(Z.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),a=document.querySelector(".progress-wrapper"),n=function(e){e.target.dataset&&e.target.dataset.lang&&function(e){vt=e}(e.target.dataset.lang),document.querySelector(".start-screen").style.display="none"};Zt=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),n(t)})),a.style.display="none"}}]),e}(),Xt=(a(41),{ru:{"What's happening?":"\u0427\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442?","I'm generating the Great Recursion. I need a component. Deliver it to me.":"\u042f \u0433\u0435\u043d\u0435\u0440\u044e \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u044e. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430. \u0414\u043e\u0441\u0442\u0430\u0432\u044c \u043c\u043d\u0435 \u0435\u0435.","Alright. Where can I find this component?":"\u0425\u043e\u0440\u043e\u0448\u043e. \u0413\u0434\u0435 \u043c\u043d\u0435 \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443?","I updated the location mark in your car, follow it.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435, \u0441\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","I'll be back.":"\u042f \u0432\u0435\u0440\u043d\u0443\u0441\u044c.","For the glory of Recursion.":"\u0412\u043e \u0441\u043b\u0430\u0432\u0443 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438.","Do you have a Great Recursion Component?":"\u0423 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438?","I will generate you a Great Component for the Great Recursion. I need a Component.":"\u042f \u0441\u0433\u0435\u043d\u0435\u0440\u044e \u0442\u0435\u0431\u0435 \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430.","Where can I find it?":"\u0413\u0434\u0435 \u043c\u043d\u0435 \u0435\u0435 \u043d\u0430\u0439\u0442\u0438?","I updated the location mark in the car.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u043c\u0430\u0448\u0438\u043d\u0435.","..Component.. ?":"..\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430..?","Yes. I have finished generating the Component for the Great Component of the Great Recursion.":"\u0414\u0430. \u042f \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b \u0433\u0435\u043d\u0435\u0440\u0438\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438.","I need to deliver it to generate the Great Component.":"\u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0435\u0435 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","The location mark in your car has been updated. It will point to the Component of the Great Component.":"\u0423\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d. \u041e\u043d \u0443\u043a\u0430\u0436\u0435\u0442 \u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","Is my car the key to Components?":"\u041c\u043e\u044f \u043c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u043a\u043b\u044e\u0447 \u043a \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c?","Your Car is the main Iterator. Follow it.":"\u0422\u0432\u043e\u044f \u041c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0418\u0442\u0435\u0440\u0430\u0442\u043e\u0440. \u0421\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",drive:"\u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435",exit:"\u0432\u044b\u0439\u0442\u0438","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),Lt=jt(Xt),Yt=Object(Ot.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(_t.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(_t.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:Lt(t.q)},Math.floor(1e5*Math.random()))}))})})),Ft=jt(Xt),Et=Object(Ot.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(_t.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(_t.jsxs)("div",{children:[Object(_t.jsx)("div",{className:"q",children:Ft(e.q)}),Object(_t.jsx)("div",{className:"a",children:Ft(e.a)})]},Math.floor(1e5*Math.random()))}))})})),Dt=jt(Xt);var At=Object(Ot.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocationOfList:e.ui.currentLocationOfList,locationsList:e.ui.locationsList}}))((function(e){return Object(_t.jsxs)(_t.Fragment,{children:[!e.isShowFinalMessage&&e.isButtonDialog&&!e.isShowPalleteDialog&&Object(_t.jsx)("button",{className:"control control-enter",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!0})}}),e.isShowPalleteDialog&&Object(_t.jsx)("div",{className:"dialog-wrapper",children:Object(_t.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(_t.jsxs)("div",{className:"messages-wrapper",children:[Object(_t.jsx)(Et,{}),Object(_t.jsx)(Yt,{})]}),e.isButtonDialog&&Object(_t.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?Dt("close dialog"):Dt("open dialog")})]})}),e.isShowButtonDrawCar&&Object(_t.jsx)("button",{className:"control ".concat("exit"===e.valButtonDrawCar?"control-exit":"control-enter"),onClick:function(){return e.dispatch({type:"CLICK_DRAW"})}}),e.isShowFinalMessage&&Object(_t.jsxs)("div",{className:"final-mess",children:["                    ",Object(_t.jsx)("button",{className:"final-button",onClick:function(){window.location.replace("./../08")},children:Dt("Continue")})]})]})})),Rt=a(7),Gt={location01:"location02",location02:"location03",location03:"locationToFinish"},Bt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"drive",currentLocation:null,phrasesData:{location01:{isComplete:!1,phraseIndex:0,phrases:[{q:"What's happening?",a:"I'm generating the Great Recursion. I need a component. Deliver it to me.",event:"nextReply"},{q:"Alright. Where can I find this component?",a:"I updated the location mark in your car, follow it.",event:"nextReply"},{q:"I'll be back.",a:"For the glory of Recursion.",event:"close"}]},location02:{isComplete:!1,phraseIndex:0,phrases:[{q:"Do you have a Great Recursion Component?",a:"I will generate you a Great Component for the Great Recursion. I need a Component.",event:"nextReply"},{q:"Where can I find it?",a:"I updated the location mark in the car.",event:"close"}]},location03:{isComplete:!1,phraseIndex:0,phrases:[{q:"..Component.. ?",a:"Yes. I have finished generating the Component for the Great Component of the Great Recursion.",event:"nextReply"},{q:"I need to deliver it to generate the Great Component.",a:"The location mark in your car has been updated. It will point to the Component of the Great Component.",event:"nextReply"},{q:"Is my car the key to Components?",a:"Your Car is the main Iterator. Follow it.",event:"close"}]}},isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1},zt=a.p+"static/media/texture01.5a2e51e3.jpg",qt=a.p+"static/media/texture01_inv.2af79fbc.jpg",Wt=function(){function e(t){var a=this;Object(N.a)(this,e);var n=new u.c;t.player.getCamera().add(n),this._sound=new u.b(n),this._sound.setBuffer(t.assets.soundAmbient),this._sound.setLoop(!0),this._sound.setVolume(.35),this._soundCar=new u.b(n),this._soundCar.setBuffer(t.assets.soundPlatform),this._soundCar.setLoop(!0),this._soundCar.setVolume(.5),this._w=new u.b(n),this._w.setBuffer(t.assets.soundStep),this._w.setLoop(!0),this._w.setVolume(.3),this._isMuted=!1,t.emitter.subscribe("toggleSound")((function(e){a._isMuted=e,e?(a._sound.isPlaying&&a._sound.stop(),a._soundCar.isPlaying&&a._soundCar.stop()):a._sound.play()})),this._timer=null}return Object(Z.a)(e,[{key:"playAmbient",value:function(){this._sound.play()}},{key:"startCar",value:function(){this._isMuted||this._soundCar.play()}},{key:"stopCar",value:function(){this._isMuted||(this._soundCar.isPlaying&&this._soundCar.stop(),clearTimeout(this._timer))}},{key:"startWalk",value:function(){this._isMuted||this._w.play()}},{key:"stopWalk",value:function(){this._isMuted||this._w.isPlaying&&this._w.stop()}}]),e}(),Ut=a.p+"static/media/steps.47eecadc.mp3",Vt=[{key:"emitter",constr:F,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(N.a)(this,e);var a=t.emitter,n=t.appWrapper;!n&&(n=document.querySelector(".app-wrapper")),a.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&o()}));var o=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},r=function(e){n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||a.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:Y,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:R,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(N.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return G.c()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:z,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:q,initStateKey:"beforeStartPlay"},{key:"player",constr:K,initStateKey:"beforeStartPlay"},{key:"system_PlayerMoveOnLevel",constr:Q,initStateKey:"beforeStartPlay"},{key:"system_Sound",constr:Wt,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"soundMp3",path:a.p+"static/media/ambient_07.b81bb8ae.mp3",key:"soundAmbient"},{type:"soundMp3",path:Ut,key:"soundStep"},{type:"soundMp3",path:a.p+"static/media/fly.54491b12.mp3",key:"soundPlatform"}]},{key:"customUi",constr:function e(t){Object(N.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=At,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bt,a=arguments.length>1?arguments[1]:void 0;if("TOGGLE_BUTTON_DIALOG"===a.type){var n=a.keyPerson.split("_")[1],o=[];if(t.phrasesData[n])for(var r=t.phrasesData[n],s=r.phraseIndex,i=r.phrases,c=0;c<s;++c)o.push(i[c]);return Object(D.a)(Object(D.a)({},t),{},{isButtonDialog:a.is,currentLocation:n,userReplicies:[],botAnswers:o})}if("TOGGLE_DIALOG"===a.type){var p=[];if(e.player.toggleBlocked(a.isShowPalleteDialog),a.isShowPalleteDialog){var u=t.phrasesData[t.currentLocation],l=u.isComplete,h=u.phraseIndex,d=u.phrases;p=l?[]:[d[h]]}return setTimeout((function(){return e.dispatcher.dispatch({type:"TOGGLE_CONTROLS",is:!a.isShowPalleteDialog})})),Object(D.a)(Object(D.a)({},t),{},{isShowPalleteDialog:a.isShowPalleteDialog,userReplicies:p})}if("CLICK_PHRASE"===a.type)return Object(D.a)(Object(D.a)({},t),{},{botAnswers:[].concat(Object(ee.a)(t.botAnswers),[a.phrase]),userReplicies:[]});if("PHRASE_EVENT"===a.type){var b=a.phrase.event;if("nextReply"===b){var m=t.phrasesData[t.currentLocation],y=m.phraseIndex+1,f=[m.phrases[y]];return Object(D.a)(Object(D.a)({},t),{},{phrasesData:Object(D.a)(Object(D.a)({},t.phrasesData),{},Object(Rt.a)({},t.currentLocation,Object(D.a)(Object(D.a)({},t.phrasesData[t.currentLocation]),{},{phraseIndex:y}))),userReplicies:f})}if("close"===b){var O=t.phrasesData[t.currentLocation].phraseIndex+1;return setTimeout((function(){e.dispatcher.dispatch({type:"SELECT_LOCATION",location:Gt[t.currentLocation]})}),50),Object(D.a)(Object(D.a)({},t),{},{userReplicies:[],phrasesData:Object(D.a)(Object(D.a)({},t.phrasesData),{},Object(Rt.a)({},t.currentLocation,Object(D.a)(Object(D.a)({},t.phrasesData[t.currentLocation]),{},{isComplete:!0,phraseIndex:O}))),isButtonDialog:!0})}}return"TOGGLE_BUTTON_DRAW_CAR"===a.type?Object(D.a)(Object(D.a)({},t),{},{isShowButtonDrawCar:a.is}):"CLICK_DRAW"===a.type?(e.emitter.emit("clickMachineDraw")(),Object(D.a)({},t)):"OPEN_LOCATIONS_LIST"===a.type?Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!0}):"SELECT_LOCATION"===a.type?(e.actions.changeTargetLocation({key:a.location}),Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!1,currentLocationOfList:a.location})):"SHOW_FINAL_MESSAGE"===a.type?Object(D.a)(Object(D.a)({},t),{},{isShowFinalMessage:!0}):t}}}(t);var a=document.createElement("button");a.style.display="none",a.classList.add("button-mouse"),a.classList.add("control-small"),document.querySelector(".app-wrapper").appendChild(a),t.buttonMouse=a,a.addEventListener("click",(function(){a.style.display="none",t.emitter.emit("clickButtonMouse")()})),document.addEventListener("pointerlockchange",(function(){document.pointerLockElement===document.body||(a.style.display="block")}));var n=new Tt(t);t.ui=n},initStateKey:"pageLoaded"},{key:"actions",constr:function e(t){var a=this;Object(N.a)(this,e),this._root=t,t.system_PlayerNearLevelItems=new $e(t);var n=this._root,o=n.dispatcher,r=n.frameUpdater,s=n.studio,i=n.system_PlayerMoveOnLevel,c=n.ui,p=n.player;n.emitter;o.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:6}),o.dispatch({type:"ENABLE_CONTROL_SOUND"}),t.materials||(t.materials={}),t.assets.textureTiles.magFilter=u.U,t.assets.textureTiles.minFilter=u.U;var l=new u.P({color:16777215,map:t.assets.textureTiles,vertexColors:!0});t.assets.textureTilesInv.magFilter=u.U,t.assets.textureTilesInv.minFilter=u.U;var h=new u.P({color:16777215,map:t.assets.textureTilesInv,vertexColors:!0}),d=new u.P({color:16777215,map:t.assets.textureTilesInv,vertexColors:!0});t.materials.matNotFog=d;var b=new u.P({color:m,fog:!1});t.materials.matNotFogOuter=b,t.materials.structureMaterial=l,t.materials.structureMaterialInv=h;var y=new u.P({color:16776960});t.materials.basicMat=y;var f=Ke(t);t.fuel=f;var O=bt(t);t.finalItem=O;var v=function(e){(new u.Y).position.set(0,0,-3e3);for(var t=new u.P({color:16711935}),a=[],n=0;n<50;++n){var o=We(t);o.position.set(-150,0,8e3*Math.random()-4e3),a.push(o)}return{addToScene:function(){for(var t=0;t<a.length;++t)e.studio.addToScene(a[t])},removeAll:function(){for(var t=0;t<a.length;++t)e.studio.removeFromScene(a[t])}}}(t);v.addToScene(),t.sprites=v;var j=qe(t);t.structure=j,j.generateStructure(M[0]).then((function(){}));var _=Ue(t);_.mesh.position.z=300,t.flyer=_,t.system_PlayerNearLevelItems.setItemToCheck(_.objectForCheck,"platformObjectForCheck",20,30);var w=t.emitter.subscribe("checkNear")((function(e){"platformObjectForCheck"===e.item&&e.is&&(w(),ct(t))}));p.setToPos(0,400,485),p.toggleBlocked(!1),r.on((function(e){G.c(),i.update(e),s.drawFrame()})),c.showStartButton((function(){p.toggleBlocked(!1),a._root.system_Sound&&a._root.system_Sound.playAmbient(),p.controls&&p.controlsLock()}))},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"img",path:zt,key:"textureTiles",wrap:!1},{type:"img",path:qt,key:"textureTilesInv",wrap:!1}]}];window.addEventListener("load",(function(){return function(e,t){return i.apply(this,arguments)}(Vt,n)}))}},[[42,1,2]]]);
//# sourceMappingURL=main.9ca126c4.chunk.js.map